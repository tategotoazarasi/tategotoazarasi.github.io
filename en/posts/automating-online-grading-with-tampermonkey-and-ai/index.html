<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Automating Online Grading with Tampermonkey and AI | Tategoto Azarasi</title>
<meta name=keywords content="tampermonkey,userscript,ai,baidu-ernie,llm,homework-grading,grading-automation,education-technology,edtech,javascript,dom-manipulation,api-integration,gm-xmlhttprequest,cors-workaround,prompt-engineering,json,browser-automation,teacher-tools"><meta name=description content="Discover how a Tampermonkey userscript was developed using Baidu Ernie AI to automate scoring and commenting for online short-answer homework, significantly reducing repetitive grading tasks for educators."><meta name=author content="Tategoto Azarasi"><link rel=canonical href=https://tategotoazarasi.github.io/en/posts/automating-online-grading-with-tampermonkey-and-ai/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://tategotoazarasi.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tategotoazarasi.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tategotoazarasi.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://tategotoazarasi.github.io/apple-touch-icon.png><link rel=mask-icon href=https://tategotoazarasi.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://tategotoazarasi.github.io/en/posts/automating-online-grading-with-tampermonkey-and-ai/><link rel=alternate hreflang=zh href=https://tategotoazarasi.github.io/zh/posts/automating-online-grading-with-tampermonkey-and-ai/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ rel=stylesheet><script crossorigin=anonymous defer integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js></script><script crossorigin=anonymous defer integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR onload=renderMathInElement(document.body) src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js></script>>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><meta property="og:url" content="https://tategotoazarasi.github.io/en/posts/automating-online-grading-with-tampermonkey-and-ai/"><meta property="og:site_name" content="Tategoto Azarasi"><meta property="og:title" content="Automating Online Grading with Tampermonkey and AI"><meta property="og:description" content="Discover how a Tampermonkey userscript was developed using Baidu Ernie AI to automate scoring and commenting for online short-answer homework, significantly reducing repetitive grading tasks for educators."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-05-02T17:16:19+08:00"><meta property="article:modified_time" content="2025-05-02T17:16:19+08:00"><meta property="article:tag" content="Tampermonkey"><meta property="article:tag" content="Userscript"><meta property="article:tag" content="Ai"><meta property="article:tag" content="Baidu-Ernie"><meta property="article:tag" content="Llm"><meta property="article:tag" content="Homework-Grading"><meta name=twitter:card content="summary"><meta name=twitter:title content="Automating Online Grading with Tampermonkey and AI"><meta name=twitter:description content="Discover how a Tampermonkey userscript was developed using Baidu Ernie AI to automate scoring and commenting for online short-answer homework, significantly reducing repetitive grading tasks for educators."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tategotoazarasi.github.io/en/posts/"},{"@type":"ListItem","position":2,"name":"Automating Online Grading with Tampermonkey and AI","item":"https://tategotoazarasi.github.io/en/posts/automating-online-grading-with-tampermonkey-and-ai/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Automating Online Grading with Tampermonkey and AI","name":"Automating Online Grading with Tampermonkey and AI","description":"Discover how a Tampermonkey userscript was developed using Baidu Ernie AI to automate scoring and commenting for online short-answer homework, significantly reducing repetitive grading tasks for educators.","keywords":["tampermonkey","userscript","ai","baidu-ernie","llm","homework-grading","grading-automation","education-technology","edtech","javascript","dom-manipulation","api-integration","gm-xmlhttprequest","cors-workaround","prompt-engineering","json","browser-automation","teacher-tools"],"articleBody":"Today I want to share a somewhat special programming project – one not born out of a desire for flashy tech or commercial application, but from a simple idea: helping my mom lighten her workload a bit.\nMy mother is a dedicated teacher, and with the rise of online education, much of her work, including grading assignments, has moved online. While this undoubtedly increases teaching flexibility, it also brings new challenges. Grading homework on certain online platforms, in particular, involves a significant amount of repetitive actions, which is both time-consuming and mentally draining. Seeing her often busy late into the night, as her son, I always thought about whether I could use the technical skills I’ve learned to do something for her.\nThe specific target this time was the grading process for “short-answer questions” on her teaching platform. These types of questions typically require the teacher to read the student’s response, then assign a score and provide written feedback. While the final judgment and personalized feedback are irreplaceable, there seemed to be room for automation in the initial scoring and basic comment generation.\nThus began an exploratory journey combining browser scripting, DOM manipulation, API calls, and a touch of artificial intelligence.\nStarting with the Browser Console Getting started is always the hardest part. The most direct thought was: “Can I run some code in the browser to simulate mouse clicks and keyboard input?” The answer is yes. The browser’s developer tools (opened by pressing F12) and specifically the “Console” tab are powerful weapons for this.\nThe first step in automation is teaching the code to “recognize” the elements on the page. Just as a person grading needs to find the question, the answer box, the score field, the comment area, and the submit button, the code needs specific “addresses” – DOM selectors – to locate these elements.\nOpening a typical assignment grading page, the initial exploration involved carefully studying its HTML structure using the developer tools. We discovered some consistent design patterns: the content and response area for each short-answer question were usually entirely wrapped within a list item element. To differentiate question types or provide unique identifiers, these elements often carried specific attributes, such as data-questiontype=\"5\" perhaps marking it as a short-answer question, along with a unique id attribute.\nInside each representing a question, we could find an tag used for entering the score. This input field not only revealed the maximum possible score for the question via its max attribute but also hinted at how backend data processing might be indexed through its name attribute (often formatted like questions[0].studentScore).\nThe commenting functionality appeared more dynamic. Initially, only a “Comment” button was visible, typically implemented as a tag (perhaps with a class like modify). A user click on this button would dynamically reveal the text area for entering the comment – usually a \u003c/code\u003e element (possibly with classes like \u003ccode\u003eteacherWrite comments\u003c/code\u003e) – along with a “Done” or “Confirm” button (maybe a \u003ccode\u003e\u003cdiv\u003e\u003c/code\u003e tag) to finalize the comment input.\n\u003cp\u003eFinally, near the bottom of the page, there was generally a global action button, such as “Submit and Grade Next,” designed to save all the grading results (scores and comments) for the current page in one go and then load the next assignment requiring attention. Locating and understanding these key elements formed the foundation for the subsequent automation script design.\n\u003cp\u003eWith the interactive page elements identified, the basic automation workflow began to take shape. First, the script needed to identify all the short-answer questions on the page requiring attention. This could be achieved using the \u003ccode\u003edocument.querySelectorAll\u003c/code\u003e method combined with the selectors identified earlier (like \u003ccode\u003eli[data-questiontype=\"5\"]\u003c/code\u003e), yielding a list of all the relevant \u003ccode\u003e\u003cli\u003e\u003c/code\u003e elements.\n\u003cp\u003eNext, the script would need to process each question element in this list sequentially, typically involving a loop. Within each iteration of the loop, focusing on the current question, the script would perform two core tasks: filling in the score and adding a comment.\n\u003cp\u003eFor scoring, the initial idea was to locate the score input field within the current question element, read its \u003ccode\u003emax\u003c/code\u003e attribute to get the maximum possible score, and then directly set the input’s \u003ccode\u003evalue\u003c/code\u003e to this maximum score. This was conceived as a basic starting strategy, open to later refinement with more complex logic, but viable as a starting point.\n\u003cp\u003eAdding the comment was slightly more complex due to the dynamic nature of the elements involved. The script would first need to find and simulate a click on the “Comment” button. Crucially, after the click, it couldn’t immediately search for the comment box; \u003cstrong\u003ea waiting period\u003c/strong\u003e was essential because the comment input area and the “Done” button were dynamically loaded or displayed, requiring time for the page to react. Once the wait was over, the script would locate the newly appeared \u003ccode\u003e\u003ctextarea\u003e\u003c/code\u003e element for comments and set its \u003ccode\u003evalue\u003c/code\u003e to a predefined, generic comment text. Finally, it would find and simulate a click on the corresponding “Done” button to confirm the entry of this comment.\n\u003cp\u003eTo enhance the stability of the automation process and better mimic human interaction patterns, incorporating a short delay after completing all steps for one question was deemed necessary. This pause helps prevent issues caused by excessively rapid operations that might outpace the page’s script responsiveness or potentially trigger anti-bot mechanisms on some websites.\n\u003cp\u003eAfter processing all questions according to this flow, the logical final step would be to simulate a click on the global submit button at the bottom of the page to save all the grading results. However, considering the risks associated with full automation and the importance of allowing the teacher a final review opportunity, this final submission step was initially designated as optional or to be triggered manually by the user. This preliminary plan, primarily relying on direct DOM manipulation, laid the groundwork for the subsequent coding implementation.\n\u003cp\u003eThis initial concept relied heavily on \u003cstrong\u003edirect DOM manipulation\u003c/strong\u003e (finding an element -\u003e modifying its attributes/triggering clicks). Within the browser console, this is often feasible.\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// Pseudocode Example: Initial Concept \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egradeShortAnswer\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003equestionElement\u003c/span\u003e) { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e// Find score input and set to max score \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003escoreInput\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003equestionElement\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003equerySelector\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e'input.student-score'\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emaxScore\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003escoreInput\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e?\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003emax\u003c/span\u003e; \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003escoreInput\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026\u0026\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emaxScore\u003c/span\u003e) { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003escoreInput\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003evalue\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emaxScore\u003c/span\u003e; \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e`Set score for \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003equestionElement\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e to \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003emaxScore\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e// Trigger events so the page knows the value changed (Important!) \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a6e22e\"\u003escoreInput\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003edispatchEvent\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eEvent\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e'input'\u003c/span\u003e, {\u003cspan style=\"color:#a6e22e\"\u003ebubbles\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e})); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003escoreInput\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003edispatchEvent\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eEvent\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e'change'\u003c/span\u003e, {\u003cspan style=\"color:#a6e22e\"\u003ebubbles\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003etrue\u003c/span\u003e})); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t} \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e// Find and click the \"Comment\" button \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecommentButton\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003equestionElement\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003equerySelector\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e'.comment span.modify'\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ecommentButton\u003c/span\u003e) { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ecommentButton\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eclick\u003c/span\u003e(); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e// Need to wait for the comment box to appear... \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a6e22e\"\u003esetTimeout\u003c/span\u003e(() =\u003e { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecommentArea\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003equestionElement\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003equerySelector\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e'.comment textarea.teacherWrite'\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003econfirmButton\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003equestionElement\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003equerySelector\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e'.comment div.confirm'\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ecommentArea\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026\u0026\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003econfirmButton\u003c/span\u003e) { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ecommentArea\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003evalue\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\"Student's response is good!\"\u003c/span\u003e; \u003cspan style=\"color:#75715e\"\u003e// Preset comment \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a6e22e\"\u003econfirmButton\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eclick\u003c/span\u003e(); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e`Comment added for \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003equestionElement\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t} \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}, \u003cspan style=\"color:#ae81ff\"\u003e1000\u003c/span\u003e); \u003cspan style=\"color:#75715e\"\u003e// Assuming a 1-second wait \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t} \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e} \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// Get all short-answer questions and process \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// document.querySelectorAll('#shiti-content li.subjective[data-questiontype=\"5\"]') \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// .forEach(el =\u003e gradeShortAnswer(el)); \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// Note: Real application requires more complex async handling and error management \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eThis approach seems appealing, but in practice, especially on complex, dynamically loaded modern web pages, it often encounters its first major roadblock.\n\u003ch2 id=\"exploring-the-api-route-and-rich-text-editor-pitfalls\"\u003eExploring the API Route (and Rich Text Editor Pitfalls)\u003c/h2\u003e \u003cp\u003eIn the context of real-world teaching platforms (including both the discussion forum scenarios explored earlier and the current homework grading task), the comment input field is frequently not a simple \u003ccode\u003e\u003ctextarea\u003e\u003c/code\u003e. Instead, it’s often a * *Rich Text Editor (RTE)**, such as the familiar UEditor, CKEditor, or TinyMCE.\n\u003cp\u003eThese editors typically render a complex structure, often involving an \u003ccode\u003e\u003ciframe\u003e\u003c/code\u003e or a \u003ccode\u003e\u003cdiv\u003e\u003c/code\u003e with the \u003ccode\u003econtenteditable\u003c/code\u003e attribute, in place of the original \u003ccode\u003e\u003ctextarea\u003e\u003c/code\u003e (or sometimes even a \u003ccode\u003e\u003cscript\u003e\u003c/code\u003e tag), and provide a toolbar for formatting.\n\u003cp\u003eHowever, this assumption of directly manipulating a simple \u003ccode\u003e\u003ctextarea\u003e\u003c/code\u003e encounters challenges when faced with the Rich Text Editors commonly used on these platforms. The introduction of these editors complicates the seemingly straightforward interaction. Firstly, the \u003cstrong\u003eDOM structure itself changes\u003c/strong\u003e. We can no longer directly target a simple text input; instead, we must navigate into the more complex structure generated by the editor, such as an embedded \u003ccode\u003e\u003ciframe\u003e\u003c/code\u003e element, and then further locate the editable \u003ccode\u003e\u003cbody\u003e\u003c/code\u003e within that iframe, or perhaps a specific \u003ccode\u003e\u003cdiv\u003e\u003c/code\u003e element configured with the \u003ccode\u003econtenteditable\u003c/code\u003e attribute.\n\u003cp\u003eSecondly, and more critically, is the \u003cstrong\u003edependency on the editor’s API\u003c/strong\u003e. Rich Text Editors usually have their own set of JavaScript APIs to manage content and state. If we bypass these APIs and directly modify the \u003ccode\u003einnerHTML\u003c/code\u003e of the \u003ccode\u003e\u003ciframe\u003e\u003c/code\u003e or the \u003ccode\u003einnerText\u003c/code\u003e of a \u003ccode\u003econtenteditable\u003c/code\u003e element, the editor’s internal state might not update accordingly. The direct consequence is that when a save action is triggered (like clicking the “Done” button), the editor might still consider the content empty or unchanged because it relies on its API calls to synchronize and retrieve the final content (often synchronizing it to a hidden form field). Therefore, merely altering the visual presentation doesn’t guarantee the data will be captured correctly.\n\u003cp\u003eFinally, \u003cstrong\u003einstance management\u003c/strong\u003e also becomes a factor. On a page containing multiple short-answer questions, each question’s comment box is typically an independent instance of the Rich Text Editor. This means if we want to interact via API, we must be able to accurately identify and obtain the specific instance object for the editor corresponding to the question currently being processed. Only then can we call its specific methods (like setting content or focusing). This undoubtedly increases the complexity of the automation script. The emergence of these issues indicated that direct DOM manipulation might be insufficient for handling RTE scenarios, necessitating an exploration into using the editor’s API.\n\u003cp\u003eFacing the challenges posed by Rich Text Editors, the natural next step was to attempt interaction using the editor’s own provided API, which is generally the more standardized and reliable method. Taking the common UEditor as an example, the standard operational workflow typically involves these steps: First, identify the unique identifier of the target editor container within the page’s DOM. This ID is usually associated with the element (sometimes a \u003ccode\u003e\u003cscript\u003e\u003c/code\u003e tag, sometimes the outermost \u003ccode\u003e\u003cdiv\u003e\u003c/code\u003e rendered by the editor) that the editor was initialized upon. Once this ID is obtained, one can call UEditor’s global method \u003ccode\u003eUE.getEditor('editorID')\u003c/code\u003e to retrieve the JavaScript instance object for that specific editor. With this instance object in hand, various methods can be invoked, such as using \u003ccode\u003eeditorInstance.setContent('your comment HTML', false)\u003c/code\u003e to set the editor’s content (where the second argument \u003ccode\u003efalse\u003c/code\u003e usually means overwriting existing content), or calling \u003ccode\u003eeditorInstance.focus()\u003c/code\u003e to bring focus to the editor. However, before invoking methods that manipulate content, it’s crucial to ensure the editor has fully initialized and is ready to accept API calls. This is typically achieved using the \u003ccode\u003eeditorInstance.ready(callback)\u003c/code\u003e method, placing the actual content manipulation code within the provided callback function to avoid errors caused by calling APIs on an incompletely loaded editor.\n\u003cp\u003eThis standard API workflow sounds quite robust and sufficient for interacting with Rich Text Editors. However, theory and practice sometimes diverge. In our previous automation explorations, both in discussion forum scenarios and during the current homework grading attempt, trying to interact with UEditor instances via the API led to unexpected and perplexing difficulties. The primary issue encountered was that \u003cstrong\u003eeditor instance registration seemed delayed or even failed entirely\u003c/strong\u003e. Using script logic, we could accurately locate the editor’s container \u003ccode\u003e\u003cdiv\u003e\u003c/code\u003e element rendered on the page, for instance, one with the ID \u003ccode\u003eedui78\u003c/code\u003e. But subsequent attempts to fetch the instance for this ID using \u003ccode\u003eUE.getEditor('edui78')\u003c/code\u003e frequently returned \u003ccode\u003enull\u003c/code\u003e or \u003ccode\u003eundefined\u003c/code\u003e, indicating failure. To investigate further, we examined UEditor’s global object \u003ccode\u003eUE.instants\u003c/code\u003e, which manages all initialized instances, only to be surprised that the ID \u003ccode\u003eedui78\u003c/code\u003e we found was \u003cstrong\u003enot listed\u003c/strong\u003e in this global registry at all! This implied that although the editor was visually rendered and present on the page, its corresponding JavaScript control instance wasn’t being registered in the expected manner, preventing us from accessing it through the official API.\n\u003cp\u003eAdditionally, we sometimes encountered \u003cstrong\u003eID mismatch issues\u003c/strong\u003e. In certain situations, the ID under which the editor instance was actually registered in \u003ccode\u003eUE.instants\u003c/code\u003e did not match the ID of the outermost container \u003ccode\u003e\u003cdiv\u003e\u003c/code\u003e rendered on the page. This meant that even if an instance was successfully registered, we might fail to retrieve it because we were using the incorrect ID derived from the visible DOM element, further complicating and adding uncertainty to automation attempts via the API. These practical pitfalls made the seemingly ideal API approach fraught with difficulty.\n\u003cp\u003eAfter multiple attempts involving increased delays, trying different selectors, and inspecting \u003ccode\u003eUE.instants\u003c/code\u003e, the conclusion was clear: \u003cstrong\u003ein this specific dynamically loaded context, relying on the UEditor API to inject comments was unreliable.\u003c/strong\u003e The editor’s initialization process likely involved some specific mechanism or perhaps a bug that prevented us from consistently obtaining and controlling the target comment box instance.\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// Pseudocode Example: Failed API Attempt \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003easync\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003etryApiComment\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003equestionElement\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ecommentHtml\u003c/span\u003e) { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecommentContainer\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003equestionElement\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003equerySelector\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e'.comment'\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eeditorDiv\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecommentContainer\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e?\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003equerySelector\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e'div.edui-editor[id^=\"edui\"]'\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eeditorDiv\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eeditorDiv\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e) { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eerror\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\"Cannot find editor div\"\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e; \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t} \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eeditorId\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eeditorDiv\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e; \u003cspan style=\"color:#75715e\"\u003e// e.g., \"edui78\" \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e`Attempting to get editor instance: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eeditorId\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e// **** THE PROBLEM AREA **** \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#75715e\"\u003e// Often failed because 'edui78' wasn't registered in UE.instants \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#75715e\"\u003e// or UE.getEditor returned undefined/null even if the div existed. \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eeditorInstance\u003c/span\u003e; \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eeditorInstance\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eUE\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003egetEditor\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eeditorId\u003c/span\u003e); \u003cspan style=\"color:#75715e\"\u003e// \u003c--- Fails or returns unusable instance \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eeditorInstance\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003etypeof\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eeditorInstance\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003esetContent\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!==\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e'function'\u003c/span\u003e) { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ethrow\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Error(\u003cspan style=\"color:#e6db74\"\u003e\"Instance invalid or not ready\"\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t} \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t} \u003cspan style=\"color:#66d9ef\"\u003ecatch\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e) { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eerror\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e`Failed to get or validate UE instance \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eeditorId\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e:`\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e; \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t} \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e// **** END PROBLEM AREA **** \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e// Code below here would likely not be reached or would fail \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eawait\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Promise(\u003cspan style=\"color:#a6e22e\"\u003eresolve\u003c/span\u003e =\u003e \u003cspan style=\"color:#a6e22e\"\u003eeditorInstance\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eready\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eresolve\u003c/span\u003e)); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eeditorInstance\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003esetContent\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ecommentHtml\u003c/span\u003e, \u003cspan style=\"color:#66d9ef\"\u003efalse\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e// ... click confirm ... \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e} \u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWith the API route seemingly blocked, the only option left was to return to the more “primitive” method.\n\u003ch2 id=\"revisiting-dom-manipulation\"\u003eRevisiting DOM Manipulation\u003c/h2\u003e \u003cp\u003eAfter repeatedly hitting roadblocks while trying to use the editor’s API, and facing an editor instance that seemed uncontrollable through standard means, we had to reconsider our initial approach and \u003cstrong\u003ereturn to the path of direct DOM manipulation\u003c/strong\u003e. This time, however, we needed to learn from past mistakes and make adjustments based on our understanding of how Rich Text Editors typically function.\n\u003cp\u003eFirst, the \u003cstrong\u003etarget of manipulation needed to be more precise\u003c/strong\u003e. We knew that the final content displayed by an RTE usually resides within an \u003ccode\u003e\u003ciframe\u003e\u003c/code\u003e element. Therefore, the script’s core task shifted from trying to find and manipulate a potentially non-existent or inaccessible \u003ccode\u003e\u003ctextarea\u003e\u003c/code\u003e to accurately locating this \u003ccode\u003e\u003ciframe\u003e\u003c/code\u003e. It then needed to delve deeper into its \u003ccode\u003econtentDocument\u003c/code\u003e to find the actual \u003ccode\u003e\u003cbody\u003e\u003c/code\u003e element (often marked with a class like \u003ccode\u003eview\u003c/code\u003e and having its \u003ccode\u003econtentEditable\u003c/code\u003e attribute set to \u003ccode\u003etrue\u003c/code\u003e) which holds the content and allows user editing.\n\u003cp\u003eSecond, the \u003cstrong\u003eissue of data synchronization\u003c/strong\u003e had to be addressed. Since we couldn’t reliably find and update the hidden \u003ccode\u003e\u003ctextarea\u003e\u003c/code\u003e that, in theory, should exist for form submission (it either didn’t appear as expected or was too deeply buried by the editor’s complex mechanisms), we had to make a \u003cstrong\u003ecritical, albeit risky, assumption\u003c/strong\u003e. We assumed that when the user (or our script) clicks the “Done” button associated with the comment box, the page’s own JavaScript logic bound to that button \u003cstrong\u003ereads the current content directly from the \u003ccode\u003e\u003ciframe\u003e\u003c/code\u003e’s inner \u003ccode\u003e\u003cbody\u003e\u003c/code\u003e element\u003c/strong\u003e, rather than from the elusive \u003ccode\u003e\u003ctextarea\u003e\u003c/code\u003e. This content would then be used for subsequent processing, such as saving or submitting the comment. This was undoubtedly an assumption based on observation and reverse-engineering guesswork, but given the inability to gain control via the editor’s instance, it seemed the only viable path forward, albeit tinged with a degree of uncertainty. This assumption allowed us to bypass the API and simulate comment input by directly modifying the \u003ccode\u003e\u003ciframe\u003e\u003c/code\u003e’s content.\n\u003cp\u003eBased on this key assumption – that the page’s “Done” button reads directly from the \u003ccode\u003e\u003ciframe\u003e\u003c/code\u003e content – we readjusted the core automation workflow. The general sequence of steps for the script became: first, as before, identify all the short-answer list item \u003ccode\u003e\u003cli\u003e\u003c/code\u003e elements on the page; next, iterate through these questions sequentially. For each question, initially locate its score input field, set the desired score (e.g., defaulting to the maximum), and ensure relevant update events are triggered. Then comes the crucial step: find and simulate a click on that question’s \" Comment\" button. After clicking, it’s vital to \u003cstrong\u003epatiently wait\u003c/strong\u003e, allowing the page sufficient time to dynamically load or display the Rich Text Editor’s \u003ccode\u003e\u003ciframe\u003e\u003c/code\u003e along with the adjacent “Done” button. Once these elements appear, the script concentrates on \u003cstrong\u003efinding the target \u003ccode\u003e\u003ciframe\u003e\u003c/code\u003e\u003c/strong\u003e – typically nested within the editor’s main container \u003ccode\u003e\u003cdiv\u003e\u003c/code\u003e ( perhaps with a class like \u003ccode\u003eedui-editor\u003c/code\u003e) and possibly having an ID following a pattern (like \u003ccode\u003eueditor_X\u003c/code\u003e). Upon successfully locating the \u003ccode\u003e\u003ciframe\u003e\u003c/code\u003e, the script accesses its \u003ccode\u003econtentDocument.body\u003c/code\u003e property to get the internal editable area, and then directly sets the \u003ccode\u003einnerHTML\u003c/code\u003e property of this area to our predefined comment text. The final action within the loop is to find and simulate a click on the “Done” button, thereby triggering the page’s own logic for saving the comment. Naturally, after completing all these steps for one question, incorporating an appropriate delay before proceeding to the next remains essential for process stability.\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// Pseudocode Example: Revised DOM Manipulation (Iframe Only) \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003easync\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecommentViaIframe\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003equestionElement\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ecommentHtml\u003c/span\u003e) { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecommentButton\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003equestionElement\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003equerySelector\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e'.comment span.modify'\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ecommentButton\u003c/span\u003e) \u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e; \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ecommentButton\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eclick\u003c/span\u003e(); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eawait\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edelay\u003c/span\u003e(\u003cspan style=\"color:#ae81ff\"\u003e1000\u003c/span\u003e); \u003cspan style=\"color:#75715e\"\u003e// Wait for iframe etc. \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecommentContainer\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003equestionElement\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003equerySelector\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e'.comment'\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eeditorDiv\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecommentContainer\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e?\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003equerySelector\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e'div.edui-editor'\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eeditorIframe\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eeditorDiv\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e?\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003equerySelector\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e'iframe[id^=\"ueditor_\"]'\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003econfirmButton\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecommentContainer\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e?\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003equerySelector\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e'div.confirm'\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eeditorIframe\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026\u0026\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003econfirmButton\u003c/span\u003e) { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eiframeDoc\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eeditorIframe\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003econtentDocument\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eeditorIframe\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003econtentWindow\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e?\u003c/span\u003e.document; \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eiframeDoc\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e?\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ebody\u003c/span\u003e) { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eiframeDoc\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ebody\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003einnerHTML\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecommentHtml\u003c/span\u003e; \u003cspan style=\"color:#75715e\"\u003e// Set content directly \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e`Set iframe content for \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003equestionElement\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003econfirmButton\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eclick\u003c/span\u003e(); \u003cspan style=\"color:#75715e\"\u003e// Trigger the page's own logic \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e`Clicked confirm for \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003equestionElement\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t} \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eerror\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\"Could not access iframe body for \"\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003equestionElement\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t} \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t} \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eerror\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\"Could not find iframe or confirm button for \"\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003equestionElement\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eid\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t} \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e} \u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eSurprisingly, this approach of “modify only the iframe, ignore the textarea” \u003cstrong\u003eactually worked\u003c/strong\u003e on our target page! This implied that the “Done” button’s click event handler indeed read the content from the \u003ccode\u003e\u003ciframe\u003e\u003c/code\u003e to save the comment, without requiring us to manually sync the mysterious (or perhaps non-existent) \u003ccode\u003e\u003ctextarea\u003e\u003c/code\u003e. It was a welcome breakthrough.\n\u003ch2 id=\"introducing-ai-for-personalized-comments\"\u003eIntroducing AI for Personalized Comments\u003c/h2\u003e \u003cp\u003eHaving solved the basic operational simulation, the next goal was to make the comments less repetitive. Generating comments based on the student’s specific answer would make the process more intelligent.\n\u003cp\u003eThis naturally led to considering Large Language Models (LLMs). Several excellent models are available, including Baidu’s Ernie series in China. They provide APIs that allow sending requests (containing information like the question, student answer, etc.) to receive model-generated content, such as the comments we needed.\n\u003ch3 id=\"choosing-the-model\"\u003eChoosing the Model\u003c/h3\u003e \u003cp\u003eConsidering the potential need to process numerous questions during grading, response speed was a requirement. At the same time, the task of generating a short comment is relatively simple. We opted for the Ernie Speed model from the Ernie family, as it offered a good balance between speed and performance for this task.\n\u003ch3 id=\"api-call-workflow\"\u003eAPI Call Workflow\u003c/h3\u003e \u003cp\u003eTo interact with the AI model, a typical API call process involves two main steps. The first is \u003cstrong\u003eobtaining an authorization credential\u003c/strong\u003e, known as an \u003ccode\u003eaccess_token\u003c/code\u003e. This requires making a request to the platform’s OAuth authentication endpoint, passing along the API Key (AK) and Secret Key (SK) obtained from the platform registration. Upon successful authentication, the endpoint returns an \u003ccode\u003eaccess_token\u003c/code\u003e string, which usually has an expiration period ( e.g., 30 days). This token acts like a temporary passport, credentialing subsequent interactions with the specific AI model services.\n\u003cp\u003eOnce a valid \u003ccode\u003eaccess_token\u003c/code\u003e is acquired, the second step is to \u003cstrong\u003ecall the specific AI model’s dialogue interface\u003c/strong\u003e, such as the Ernie Speed Chat API. This is typically a POST request sent to an endpoint URL that includes the obtained \u003ccode\u003eaccess_token\u003c/code\u003e as a parameter. The request body must be structured according to the API’s specifications. The core component is the \u003ccode\u003emessages\u003c/code\u003e field, an array representing the conversation history, which must contain at least one message with \u003ccode\u003erole: \"user\"\u003c/code\u003e. The \u003ccode\u003econtent\u003c/code\u003e of this user message is our carefully crafted \u003cstrong\u003eprompt\u003c/strong\u003e, containing the question, student’s answer, and instructions for the AI comment generation. Additionally, an optional \u003ccode\u003esystem\u003c/code\u003e field can be included to define the AI’s role and provide global instructions (e.g., “You are a university TA generating comments”). Depending on the need, other parameters like \u003ccode\u003etemperature\u003c/code\u003e or \u003ccode\u003etop_p\u003c/code\u003e can be added to control the diversity and randomness of the generated output. Upon receiving the request, the AI model processes the input based on the \u003ccode\u003emessages\u003c/code\u003e and \u003ccode\u003esystem\u003c/code\u003e prompt and returns the generated result.\n\u003ch3 id=\"cross-origin-issues-cors\"\u003eCross-Origin Issues (CORS)\u003c/h3\u003e \u003cp\u003eAttempting to call external APIs (like \u003ccode\u003ehttps://aip.baidubce.com\u003c/code\u003e) directly from browser console scripts or standard webpage JavaScript using \u003ccode\u003efetch\u003c/code\u003e or \u003ccode\u003eXMLHttpRequest\u003c/code\u003e immediately runs into \u003cstrong\u003eCORS (Cross-Origin Resource Sharing)\u003c/strong\u003e issues. For security reasons, browsers block such cross-domain requests by default, unless the target server explicitly permits them via specific response headers (like \u003ccode\u003eAccess-Control-Allow-Origin\u003c/code\u003e). Baidu’s API endpoints, being primarily designed for server-to-server communication, usually do not send the necessary headers to allow direct requests from arbitrary web origins.\n\u003cp\u003eThe browser console will explicitly state the block:\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eAccess to fetch at 'https://aip.baidubce.com/...' from origin 'http://...' has been blocked by CORS policy... \u003c/code\u003e\u003c/pre\u003e\u003ch3 id=\"the-tampermonkey-solution\"\u003eThe Tampermonkey Solution\u003c/h3\u003e \u003cp\u003eUserscript managers like Tampermonkey provide a privileged channel: the \u003ccode\u003eGM_xmlhttpRequest\u003c/code\u003e function. Code running within a userscript environment can use this function to make cross-domain requests because the request originates from the browser extension itself, not the webpage’s restricted context, thus bypassing standard CORS limitations.\n\u003cp\u003eHowever, using this powerful function requires attention to a few key details to ensure the script works correctly and has the necessary permissions. Firstly, \u003cstrong\u003eexplicit authorization must be declared in the script’s metadata block\u003c/strong\u003e (the section starting with \u003ccode\u003e// ==UserScript==\u003c/code\u003e and ending with \u003ccode\u003e// ==/UserScript==\u003c/code\u003e). A line \u003ccode\u003e// @grant GM_xmlhttpRequest\u003c/code\u003e must be included, essentially informing Tampermonkey: “This script needs permission to make cross-domain requests.” Without this declaration, attempts to call the function will fail.\n\u003cp\u003eSecondly, for security purposes, Tampermonkey usually requires the script to \u003cstrong\u003eexplicitly declare the external domains it intends to connect to\u003c/strong\u003e. Therefore, within the same metadata block, a declaration like \u003ccode\u003e// @connect aip.baidubce.com\u003c/code\u003e is needed, specifying that the script will communicate with Baidu’s AI platform API server. This declaration helps users understand the script’s network activity and allows the script manager to enforce finer-grained permissions.\n\u003cp\u003eLastly, it’s crucial to understand that \u003ccode\u003eGM_xmlhttpRequest\u003c/code\u003e is inherently an \u003cstrong\u003easynchronous operation\u003c/strong\u003e. This means that after initiating a request, the script execution doesn’t pause to wait for the response; it continues with the subsequent code. Consequently, handling the request’s outcome requires using asynchronous programming patterns. Common approaches include providing callback functions to \u003ccode\u003eGM_xmlhttpRequest\u003c/code\u003e—such as \u003ccode\u003eonload\u003c/code\u003e for successful responses, \u003ccode\u003eonerror\u003c/code\u003e for network or other errors, and \u003ccode\u003eontimeout\u003c/code\u003e for timeouts. A more modern and often more manageable approach for complex workflows involves wrapping the \u003ccode\u003eGM_xmlhttpRequest\u003c/code\u003e call within a JavaScript \u003ccode\u003ePromise\u003c/code\u003e object, which then allows the use of \u003ccode\u003easync/await\u003c/code\u003e syntax. This makes the asynchronous code appear more like synchronous code, leading to clearer logic for sending requests and processing their results.\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// Pseudocode Example: Using GM_xmlhttpRequest for Token \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003egetAccessTokenGM\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eapiKey\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003esecretKey\u003c/span\u003e) { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eurl\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e`https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials\u0026client_id=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eapiKey\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e\u0026client_secret=\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003esecretKey\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e; \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003ereturn\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Promise((\u003cspan style=\"color:#a6e22e\"\u003eresolve\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ereject\u003c/span\u003e) =\u003e { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eGM_xmlhttpRequest\u003c/span\u003e({ \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003emethod\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\"POST\"\u003c/span\u003e, \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eurl\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eurl\u003c/span\u003e, \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eheaders\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e {\u003cspan style=\"color:#e6db74\"\u003e\"Content-Type\"\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\"application/json\"\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e\"Accept\"\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\"application/json\"\u003c/span\u003e}, \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eonload\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eresponse\u003c/span\u003e) { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eresponse\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003estatus\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e===\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e200\u003c/span\u003e) { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eJSON\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eparse\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eresponse\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eresponseText\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eaccess_token\u003c/span\u003e) { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eresolve\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003edata\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eaccess_token\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t} \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ereject\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Error(\u003cspan style=\"color:#e6db74\"\u003e\"Token not found in response\"\u003c/span\u003e)); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t} \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t} \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ereject\u003c/span\u003e(\u003cspan style=\"color:#66d9ef\"\u003enew\u003c/span\u003e Error(\u003cspan style=\"color:#e6db74\"\u003e\"HTTP error getting token: \"\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e+\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresponse\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003estatus\u003c/span\u003e)); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t} \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}, \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eonerror\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ereject\u003c/span\u003e, \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003eontimeout\u003c/span\u003e\u003cspan style=\"color:#f92672\"\u003e:\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ereject\u003c/span\u003e \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t}); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e} \u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eWith CORS issues resolved, we could now communicate freely with the AI from within the script.\n\u003ch2 id=\"prompt-engineering-and-json-agreement\"\u003ePrompt Engineering and JSON Agreement\u003c/h2\u003e \u003cp\u003eSimply being able to call the AI wasn’t enough; the key was instructing it effectively to get the desired output. This is where \u003cstrong\u003ePrompt Engineering\u003c/strong\u003e comes in.\n\u003ch3 id=\"initial-prompt\"\u003eInitial Prompt\u003c/h3\u003e \u003cp\u003eInitially, one might just concatenate the question and student answer into the prompt and let the AI write a comment freely.\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eQuestion: Please explain the function of an empty shot (kūjìngtóu). Student Answer: Empty shots can establish the environment and transition time/space. Please provide a one-sentence comment: \u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThis might yield a comment like, “The answer is basically correct, but not comprehensive enough,” which is a decent start.\n\u003ch3 id=\"adding-more-context\"\u003eAdding More Context\u003c/h3\u003e \u003cp\u003eProviding only the question and student’s answer, while capable of generating a basic comment, might lack the nuance needed for more accurate evaluation. To enhance the AI’s assessment capabilities, we can \u003cstrong\u003eenrich the prompt with additional contextual information\u003c/strong\u003e. For instance, including the \u003cstrong\u003ecorrect answer\u003c/strong\u003e explicitly allows the AI to know the standard benchmark. Similarly, providing the official \u003cstrong\u003eanswer analysis\u003c/strong\u003e or grading rubric, if available on the page, helps the AI better grasp the question’s intended focus and evaluation criteria. Furthermore, informing the AI about the \u003cstrong\u003emaximum score\u003c/strong\u003e for the question gives it a sense of the grading scale, potentially leading to more reasonable score suggestions if we later task it with assisting in grading. By integrating these extra pieces of information, we construct a more comprehensive prompt, guiding the AI towards making more precise and well-founded judgments and comments.\n\u003cpre tabindex=\"0\"\u003e\u003ccode\u003eYou are a university teaching assistant. Please evaluate the student's answer based on the following information and provide a concise comment: Question (Max Score: 8 points): What are the specific functions and artistic values of an empty shot (kūjìngtóu)? Student Answer: (1) Establish the story environment (2) Serve as a means of spatiotemporal transition Correct Answer Reference: (1) Establish the story environment (2) Serve as a means of spatiotemporal transition (3) Render atmosphere, enhance emotion (4) Create artistic conception (yìjìng) Answer Analysis Reference: An empty shot is one containing only scenery, no characters... It serves multiple expressive functions and artistic values, specifically in four aspects. Comment: \u003c/code\u003e\u003c/pre\u003e\u003cp\u003eThis allows the AI to more clearly see which points the student covered and which were missed.\n\u003ch3 id=\"defining-output-format-json\"\u003eDefining Output Format (JSON)\u003c/h3\u003e \u003cp\u003eFree-text comments still require the script to parse them. What if we also want the AI to suggest a score? Including the score directly within the comment makes parsing more difficult and error-prone. A better approach is to have the AI return \u003cstrong\u003estructured data\u003c/strong\u003e, such as JSON.\n\u003cp\u003eThis requires modifying the \u003cstrong\u003eSystem Prompt\u003c/strong\u003e (global role/instructions for the AI) and the \u003cstrong\u003eUser Prompt\u003c/strong\u003e (specific request) to explicitly ask for a JSON object in a specific format:\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// Example System Prompt \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eDEFAULT_SYSTEM_PROMPT\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e` \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eYou are a university teaching assistant grading homework. \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eBased on the provided context, evaluate the student's answer. \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eRespond ONLY with a JSON object containing two keys: \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e1. \"score\": A numerical score between 0 and the Maximum Score (inclusive). \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e2. \"comment\": A brief, positive, and constructive comment (max 25 characters). \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eExample Response Format: \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e{ \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e \"score\": 10, \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e \"comment\": \"Accurate answer, key points clear.\" \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e} \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eDo NOT include any other text or markdown formatting. \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e; \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// Example User Prompt (used with the System Prompt) \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003euserPrompt\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e` \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eQuestion (Max Score: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003emaxScore\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e points): \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003equestionText\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eStudent Answer: \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003estudentAnswerText\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eCorrect Answer Reference: \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ecorrectAnswerText\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\"None provided\"\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eAnswer Analysis Reference: \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eanalysisText\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e||\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\"None provided\"\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003eBased on the information above, please return ONLY the JSON object with the score and comment: \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e; \u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003cp\u003eAdditionally, when calling the API, if the specific endpoint supports it (like some newer Ernie API versions), one might try adding the \u003ccode\u003e\"response_format\": \"json_object\"\u003c/code\u003e parameter to further enforce the JSON output structure.\n\u003ch3 id=\"parsing-and-application\"\u003eParsing and Application\u003c/h3\u003e \u003cp\u003eUpon receiving the \u003ccode\u003eresult\u003c/code\u003e string containing the AI’s response, the script needs to perform several processing steps before the information can be applied to the webpage. First, since AIs sometimes wrap JSON strings in markdown code block markers (like \u003ccode\u003e```json ... ```\u003c/code\u003e), an \u003cstrong\u003eoptional cleanup step\u003c/strong\u003e is necessary to remove these extraneous characters, yielding a clean JSON string.\n\u003cp\u003eThe next critical step is \u003cstrong\u003eparsing\u003c/strong\u003e. Using JavaScript’s built-in \u003ccode\u003eJSON.parse()\u003c/code\u003e method, this cleaned string is converted into a standard JavaScript object. If the AI adhered to the instructions, this object should contain the expected keys, such as \u003ccode\u003escore\u003c/code\u003e and \u003ccode\u003ecomment\u003c/code\u003e.\n\u003cp\u003eHowever, trusting external service responses implicitly is unwise, making \u003cstrong\u003evalidation\u003c/strong\u003e an essential part of the process. The script must check if the parsed object actually contains both the \u003ccode\u003escore\u003c/code\u003e and \u003ccode\u003ecomment\u003c/code\u003e properties. For the \u003ccode\u003escore\u003c/code\u003e, further validation is needed to ensure its value is a valid number and falls within the acceptable range (e.g., greater than or equal to 0 and less than or equal to the question’s maximum score). For the \u003ccode\u003ecomment\u003c/code\u003e, a simple check for a non-empty string might suffice.\n\u003cp\u003eOnly after passing these validation checks can the results be confidently \u003cstrong\u003eapplied\u003c/strong\u003e to the user interface. The validated score is inserted into the corresponding question’s score input field, and the retrieved comment is written into the comment textarea using the previously determined DOM manipulation method (which might involve clicking \" Comment,\" finding the textarea, setting its value, and then clicking “Done”). If issues arise during parsing or validation (e.g., the response isn’t valid JSON, or the score is out of range), the script should implement appropriate error handling, such as logging a warning and populating the comment field with a default message indicating failure or invalidity.\n\u003cdiv class=\"highlight\"\u003e\u003cpre tabindex=\"0\" style=\"color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;\"\u003e\u003ccode class=\"language-javascript\" data-lang=\"javascript\"\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e// Pseudocode: Handling AI JSON Response \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\u003cspan style=\"color:#66d9ef\"\u003easync\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003efunction\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ehandleAiResponse\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003eaiResultString\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003escoreInput\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ecommentArea\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003econfirmButton\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003emaxScore\u003c/span\u003e) { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003escore\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e; \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003elet\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecomment\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\"(Failed to process comment)\"\u003c/span\u003e; \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003etry\u003c/span\u003e { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e// Clean potential markdown backticks \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecleanedString\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eaiResultString\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ereplace\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e/^```json\\s*|```$/g\u003c/span\u003e, \u003cspan style=\"color:#e6db74\"\u003e''\u003c/span\u003e).\u003cspan style=\"color:#a6e22e\"\u003etrim\u003c/span\u003e(); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eJSON\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eparse\u003c/span\u003e(\u003cspan style=\"color:#a6e22e\"\u003ecleanedString\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026\u0026\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003etypeof\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003escore\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e===\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e'number'\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026\u0026\u003c/span\u003e \u003cspan style=\"color:#66d9ef\"\u003etypeof\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ecomment\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e===\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e'string'\u003c/span\u003e) { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e// Validate score \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epotentialScore\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e parseFloat(\u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003escore\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003econst\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emaxScoreNum\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e parseFloat(\u003cspan style=\"color:#a6e22e\"\u003emaxScore\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003eisNaN(\u003cspan style=\"color:#a6e22e\"\u003epotentialScore\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e\u0026\u0026\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e!\u003c/span\u003eisNaN(\u003cspan style=\"color:#a6e22e\"\u003emaxScoreNum\u003c/span\u003e) \u003cspan style=\"color:#f92672\"\u003e\u0026\u0026\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epotentialScore\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u003e=\u003c/span\u003e \u003cspan style=\"color:#ae81ff\"\u003e0\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u0026\u0026\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epotentialScore\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e\u003c=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003emaxScoreNum\u003c/span\u003e) { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003escore\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003epotentialScore\u003c/span\u003e; \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t} \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ewarn\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e`Invalid score from AI: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003escore\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e, Max: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003emaxScore\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e. Defaulting to 0.`\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ecomment\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e`(Invalid Score) \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ecomment\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e; \u003cspan style=\"color:#75715e\"\u003e// Prepend warning \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t} \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ecomment\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ecomment\u003c/span\u003e; \u003cspan style=\"color:#75715e\"\u003e// Use AI comment regardless of score validity (unless invalid JSON) \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t} \u003cspan style=\"color:#66d9ef\"\u003eelse\u003c/span\u003e { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003ewarn\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\"AI response is not valid JSON or missing keys:\"\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eresult\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ecomment\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\"(Invalid comment format)\"\u003c/span\u003e; \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t} \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t} \u003cspan style=\"color:#66d9ef\"\u003ecatch\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e) { \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eerror\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e\"Error parsing AI JSON response:\"\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003ee\u003c/span\u003e, \u003cspan style=\"color:#a6e22e\"\u003eaiResultString\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003ecomment\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#e6db74\"\u003e\"(Error parsing comment)\"\u003c/span\u003e; \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t} \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#75715e\"\u003e// Apply to UI \u003c/span\u003e\u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\u003cspan style=\"color:#75715e\"\u003e\u003c/span\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003escoreInput\u003c/span\u003e) \u003cspan style=\"color:#a6e22e\"\u003escoreInput\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003evalue\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003escore\u003c/span\u003e; \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003ecommentArea\u003c/span\u003e) \u003cspan style=\"color:#a6e22e\"\u003ecommentArea\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003evalue\u003c/span\u003e \u003cspan style=\"color:#f92672\"\u003e=\u003c/span\u003e \u003cspan style=\"color:#a6e22e\"\u003ecomment\u003c/span\u003e; \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#66d9ef\"\u003eif\u003c/span\u003e (\u003cspan style=\"color:#a6e22e\"\u003econfirmButton\u003c/span\u003e) \u003cspan style=\"color:#a6e22e\"\u003econfirmButton\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003eclick\u003c/span\u003e(); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e\t\u003cspan style=\"color:#a6e22e\"\u003econsole\u003c/span\u003e.\u003cspan style=\"color:#a6e22e\"\u003elog\u003c/span\u003e(\u003cspan style=\"color:#e6db74\"\u003e`Applied Score: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003escore\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e, Comment: \u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e${\u003c/span\u003e\u003cspan style=\"color:#a6e22e\"\u003ecomment\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e}\u003c/span\u003e\u003cspan style=\"color:#e6db74\"\u003e`\u003c/span\u003e); \u003c/span\u003e\u003c/span\u003e\u003cspan style=\"display:flex;\"\u003e\u003cspan\u003e} \u003c/span\u003e\u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u003c/div\u003e\u003ch2 id=\"integration-results-and-reflections\"\u003eIntegration, Results, and Reflections\u003c/h2\u003e \u003cp\u003eBringing together precise DOM manipulation, cross-domain API calls via Tampermonkey, essential data extraction, carefully designed AI interaction (including prompt engineering and JSON parsing), and a user-friendly trigger button resulted in a functional Tampermonkey script for assisted grading. Key to its success were crucial design principles: * \u003cem\u003easynchronous flow control\u003c/em\u003e* using \u003ccode\u003easync/await\u003c/code\u003e to manage network requests and delays sequentially; robust \u003cstrong\u003eerror handling\u003c/strong\u003e with \u003ccode\u003etry...catch\u003c/code\u003e to prevent single failures from stopping the entire process; an enhanced **user experience ** through SweetAlert for confirmations and feedback; modular \u003cstrong\u003ecode organization\u003c/strong\u003e into functions for readability and maintenance; \u003cstrong\u003eon-demand execution\u003c/strong\u003e via a button click for user control; and a constant awareness of \u003cstrong\u003esecurity implications\u003c/strong\u003e, limiting the script’s use to personal, trusted environments due to the client-side handling of API keys.\n\u003cp\u003eWhile this script demonstrably cannot replace a teacher’s nuanced judgment or personalized feedback, it effectively met its primary objective: \u003cstrong\u003esignificantly reducing repetitive workload\u003c/strong\u003e. It provides \u003cstrong\u003epreliminary AI-suggested scores\u003c/strong\u003e ( defaulting to the max or using parsed JSON values), requiring only teacher review and adjustment. It \u003cstrong\u003eautomatically generates basic comments\u003c/strong\u003e based on AI analysis, serving as a starting point for faster feedback. Most importantly, it enables \u003cstrong\u003ebatch processing\u003c/strong\u003e, handling all short-answer questions on the page sequentially with a single click, saving considerable time.\n\u003cp\u003eThis project offered profound insights into the \u003cstrong\u003ecomplexity of real-world web applications\u003c/strong\u003e, where dynamic loading and third-party components often complicate standard approaches, sometimes making direct DOM manipulation a necessary, if potentially fragile, alternative to unreliable APIs. It also clearly defined the \u003cstrong\u003eboundaries of automation\u003c/strong\u003e; technology excels at efficiency and repetitive tasks but cannot replicate the deep understanding and empathy required for high-quality educational feedback – the goal must be assistance, not replacement. Furthermore, the experience underscored the \u003cstrong\u003ecritical role of prompt engineering\u003c/strong\u003e in effectively communicating intent to AI and the value of structuring requests for predictable, usable output like JSON. Finally, it served as a potent reminder about \u003cstrong\u003esecurity consciousness\u003c/strong\u003e when handling sensitive credentials in client-side scripts.\n\u003cp\u003eIn conclusion, though a modest personal project, the journey of tackling these challenges and creating a genuinely helpful tool for family was deeply rewarding. Hopefully, sharing this exploration offers some practical insights. If you undertake a similar project, remember to \u003cstrong\u003eanalyze your specific target platform meticulously\u003c/strong\u003e, always \u003cstrong\u003eprioritize security\u003c/strong\u003e (especially with API keys), and \u003cstrong\u003eembrace the debugging process\u003c/strong\u003e using your browser’s developer tools. Often, the true joy of coding lies in overcoming these practical hurdles and making tangible, positive changes in everyday life. Thank you for reading!\n","wordCount":"5389","inLanguage":"en","datePublished":"2025-05-02T17:16:19+08:00","dateModified":"2025-05-02T17:16:19+08:00","author":{"@type":"Person","name":"Tategoto Azarasi"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tategotoazarasi.github.io/en/posts/automating-online-grading-with-tampermonkey-and-ai/"},"publisher":{"@type":"Organization","name":"Tategoto Azarasi","logo":{"@type":"ImageObject","url":"https://tategotoazarasi.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tategotoazarasi.github.io/en/ accesskey=h title="Tategoto Azarasi (Alt + H)">Tategoto Azarasi</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://tategotoazarasi.github.io/zh/ title=中文 aria-label=中文>Zh</a></li></ul></div></div><ul id=menu><li><a href=https://tategotoazarasi.github.io/en/ title=Home><span>Home</span></a></li><li><a href=https://tategotoazarasi.github.io/en/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://tategotoazarasi.github.io/en/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://tategotoazarasi.github.io/en/>Home</a>&nbsp;»&nbsp;<a href=https://tategotoazarasi.github.io/en/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Automating Online Grading with Tampermonkey and AI</h1><div class=post-meta><span title='2025-05-02 17:16:19 +0800 +0800'>May 2, 2025</span>&nbsp;·&nbsp;26 min&nbsp;·&nbsp;5389 words&nbsp;·&nbsp;Tategoto Azarasi&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://tategotoazarasi.github.io/zh/posts/automating-online-grading-with-tampermonkey-and-ai/>Zh</a></li></ul></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ol><li><a href=#starting-with-the-browser-console>Starting with the Browser Console</a></li><li><a href=#exploring-the-api-route-and-rich-text-editor-pitfalls>Exploring the API Route (and Rich Text Editor Pitfalls)</a></li><li><a href=#revisiting-dom-manipulation>Revisiting DOM Manipulation</a></li><li><a href=#introducing-ai-for-personalized-comments>Introducing AI for Personalized Comments</a><ol><li><a href=#choosing-the-model>Choosing the Model</a></li><li><a href=#api-call-workflow>API Call Workflow</a></li><li><a href=#cross-origin-issues-cors>Cross-Origin Issues (CORS)</a></li><li><a href=#the-tampermonkey-solution>The Tampermonkey Solution</a></li></ol></li><li><a href=#prompt-engineering-and-json-agreement>Prompt Engineering and JSON Agreement</a><ol><li><a href=#initial-prompt>Initial Prompt</a></li><li><a href=#adding-more-context>Adding More Context</a></li><li><a href=#defining-output-format-json>Defining Output Format (JSON)</a></li><li><a href=#parsing-and-application>Parsing and Application</a></li></ol></li><li><a href=#integration-results-and-reflections>Integration, Results, and Reflections</a></li></ol></nav></div></details></div><div class=post-content><p>Today I want to share a somewhat special programming project – one not born out of a desire for flashy tech or
commercial application, but from a simple idea: helping my mom lighten her workload a bit.</p><p>My mother is a dedicated teacher, and with the rise of online education, much of her work, including grading
assignments, has moved online. While this undoubtedly increases teaching flexibility, it also brings new challenges.
Grading homework on certain online platforms, in particular, involves a significant amount of repetitive actions, which
is both time-consuming and mentally draining. Seeing her often busy late into the night, as her son, I always thought
about whether I could use the technical skills I&rsquo;ve learned to do something for her.</p><p>The specific target this time was the grading process for &ldquo;short-answer questions&rdquo; on her teaching platform. These types
of questions typically require the teacher to read the student&rsquo;s response, then assign a score and provide written
feedback. While the final judgment and personalized feedback are irreplaceable, there seemed to be room for automation
in the initial scoring and basic comment generation.</p><p>Thus began an exploratory journey combining browser scripting, DOM manipulation, API calls, and a touch of artificial
intelligence.</p><h2 id=starting-with-the-browser-console>Starting with the Browser Console<a hidden class=anchor aria-hidden=true href=#starting-with-the-browser-console>#</a></h2><p>Getting started is always the hardest part. The most direct thought was: &ldquo;Can I run some code in the browser to simulate
mouse clicks and keyboard input?&rdquo; The answer is yes. The browser&rsquo;s developer tools (opened by pressing F12) and
specifically the &ldquo;Console&rdquo; tab are powerful weapons for this.</p><p>The first step in automation is teaching the code to &ldquo;recognize&rdquo; the elements on the page. Just as a person grading
needs to find the question, the answer box, the score field, the comment area, and the submit button, the code needs
specific &ldquo;addresses&rdquo; – DOM selectors – to locate these elements.</p><p>Opening a typical assignment grading page, the initial exploration involved carefully studying its HTML structure using
the developer tools. We discovered some consistent design patterns: the content and response area for each short-answer
question were usually entirely wrapped within a list item <code>&lt;li></code> element. To differentiate question types or provide
unique identifiers, these <code>&lt;li></code> elements often carried specific attributes, such as <code>data-questiontype="5"</code> perhaps
marking it as a short-answer question, along with a unique <code>id</code> attribute.</p><p>Inside each <code>&lt;li></code> representing a question, we could find an <code>&lt;input type="number"></code> tag used for entering the score.
This input field not only revealed the maximum possible score for the question via its <code>max</code> attribute but also hinted
at how backend data processing might be indexed through its <code>name</code> attribute (often formatted like
<code>questions[0].studentScore</code>).</p><p>The commenting functionality appeared more dynamic. Initially, only a &ldquo;Comment&rdquo; button was visible, typically
implemented as a <code>&lt;span></code> tag (perhaps with a class like <code>modify</code>). A user click on this button would dynamically reveal
the text area for entering the comment – usually a <code>&lt;textarea></code> element (possibly with classes like
<code>teacherWrite comments</code>) – along with a &ldquo;Done&rdquo; or &ldquo;Confirm&rdquo; button (maybe a <code>&lt;div></code> tag) to finalize the comment input.</p><p>Finally, near the bottom of the page, there was generally a global action button, such as &ldquo;Submit and Grade Next,&rdquo;
designed to save all the grading results (scores and comments) for the current page in one go and then load the next
assignment requiring attention. Locating and understanding these key elements formed the foundation for the subsequent
automation script design.</p><p>With the interactive page elements identified, the basic automation workflow began to take shape. First, the script
needed to identify all the short-answer questions on the page requiring attention. This could be achieved using the
<code>document.querySelectorAll</code> method combined with the selectors identified earlier (like <code>li[data-questiontype="5"]</code>),
yielding a list of all the relevant <code>&lt;li></code> elements.</p><p>Next, the script would need to process each question element in this list sequentially, typically involving a loop.
Within each iteration of the loop, focusing on the current question, the script would perform two core tasks: filling in
the score and adding a comment.</p><p>For scoring, the initial idea was to locate the score input field within the current question element, read its <code>max</code>
attribute to get the maximum possible score, and then directly set the input&rsquo;s <code>value</code> to this maximum score. This was
conceived as a basic starting strategy, open to later refinement with more complex logic, but viable as a starting
point.</p><p>Adding the comment was slightly more complex due to the dynamic nature of the elements involved. The script would first
need to find and simulate a click on the &ldquo;Comment&rdquo; button. Crucially, after the click, it couldn&rsquo;t immediately search
for the comment box; <strong>a waiting period</strong> was essential because the comment input area and the &ldquo;Done&rdquo; button were
dynamically loaded or displayed, requiring time for the page to react. Once the wait was over, the script would locate
the newly appeared <code>&lt;textarea></code> element for comments and set its <code>value</code> to a predefined, generic comment text. Finally,
it would find and simulate a click on the corresponding &ldquo;Done&rdquo; button to confirm the entry of this comment.</p><p>To enhance the stability of the automation process and better mimic human interaction patterns, incorporating a short
delay after completing all steps for one question was deemed necessary. This pause helps prevent issues caused by
excessively rapid operations that might outpace the page&rsquo;s script responsiveness or potentially trigger anti-bot
mechanisms on some websites.</p><p>After processing all questions according to this flow, the logical final step would be to simulate a click on the global
submit button at the bottom of the page to save all the grading results. However, considering the risks associated with
full automation and the importance of allowing the teacher a final review opportunity, this final submission step was
initially designated as optional or to be triggered manually by the user. This preliminary plan, primarily relying on
direct DOM manipulation, laid the groundwork for the subsequent coding implementation.</p><p>This initial concept relied heavily on <strong>direct DOM manipulation</strong> (finding an element -> modifying its
attributes/triggering clicks). Within the browser console, this is often feasible.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Pseudocode Example: Initial Concept
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>gradeShortAnswer</span>(<span style=color:#a6e22e>questionElement</span>) {
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Find score input and set to max score
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>scoreInput</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>questionElement</span>.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;input.student-score&#39;</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>maxScore</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>scoreInput</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>max</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>scoreInput</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>maxScore</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>scoreInput</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>maxScore</span>;
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Set score for </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>questionElement</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74> to </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>maxScore</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Trigger events so the page knows the value changed (Important!)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>scoreInput</span>.<span style=color:#a6e22e>dispatchEvent</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Event</span>(<span style=color:#e6db74>&#39;input&#39;</span>, {<span style=color:#a6e22e>bubbles</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>}));
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>scoreInput</span>.<span style=color:#a6e22e>dispatchEvent</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Event</span>(<span style=color:#e6db74>&#39;change&#39;</span>, {<span style=color:#a6e22e>bubbles</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span>}));
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Find and click the &#34;Comment&#34; button
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>commentButton</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>questionElement</span>.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;.comment span.modify&#39;</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>commentButton</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>commentButton</span>.<span style=color:#a6e22e>click</span>();
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Need to wait for the comment box to appear...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#a6e22e>setTimeout</span>(() =&gt; {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>commentArea</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>questionElement</span>.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;.comment textarea.teacherWrite&#39;</span>);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>confirmButton</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>questionElement</span>.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;.comment div.confirm&#39;</span>);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>commentArea</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>confirmButton</span>) {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>commentArea</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Student&#39;s response is good!&#34;</span>; <span style=color:#75715e>// Preset comment
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>				<span style=color:#a6e22e>confirmButton</span>.<span style=color:#a6e22e>click</span>();
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Comment added for </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>questionElement</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>			}
</span></span><span style=display:flex><span>		}, <span style=color:#ae81ff>1000</span>); <span style=color:#75715e>// Assuming a 1-second wait
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Get all short-answer questions and process
</span></span></span><span style=display:flex><span><span style=color:#75715e>// document.querySelectorAll(&#39;#shiti-content li.subjective[data-questiontype=&#34;5&#34;]&#39;)
</span></span></span><span style=display:flex><span><span style=color:#75715e>//    .forEach(el =&gt; gradeShortAnswer(el));
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Note: Real application requires more complex async handling and error management
</span></span></span></code></pre></div><p>This approach seems appealing, but in practice, especially on complex, dynamically loaded modern web pages, it often
encounters its first major roadblock.</p><h2 id=exploring-the-api-route-and-rich-text-editor-pitfalls>Exploring the API Route (and Rich Text Editor Pitfalls)<a hidden class=anchor aria-hidden=true href=#exploring-the-api-route-and-rich-text-editor-pitfalls>#</a></h2><p>In the context of real-world teaching platforms (including both the discussion forum scenarios explored earlier and the
current homework grading task), the comment input field is frequently not a simple <code>&lt;textarea></code>. Instead, it&rsquo;s often a *
*Rich Text Editor (RTE)**, such as the familiar UEditor, CKEditor, or TinyMCE.</p><p>These editors typically render a complex structure, often involving an <code>&lt;iframe></code> or a <code>&lt;div></code> with the
<code>contenteditable</code> attribute, in place of the original <code>&lt;textarea></code> (or sometimes even a <code>&lt;script></code> tag), and provide a
toolbar for formatting.</p><p>However, this assumption of directly manipulating a simple <code>&lt;textarea></code> encounters challenges when faced with the Rich
Text Editors commonly used on these platforms. The introduction of these editors complicates the seemingly
straightforward interaction. Firstly, the <strong>DOM structure itself changes</strong>. We can no longer directly target a simple
text input; instead, we must navigate into the more complex structure generated by the editor, such as an embedded
<code>&lt;iframe></code> element, and then further locate the editable <code>&lt;body></code> within that iframe, or perhaps a specific <code>&lt;div></code>
element configured with the <code>contenteditable</code> attribute.</p><p>Secondly, and more critically, is the <strong>dependency on the editor&rsquo;s API</strong>. Rich Text Editors usually have their own set
of JavaScript APIs to manage content and state. If we bypass these APIs and directly modify the <code>innerHTML</code> of the
<code>&lt;iframe></code> or the <code>innerText</code> of a <code>contenteditable</code> element, the editor&rsquo;s internal state might not update accordingly.
The direct consequence is that when a save action is triggered (like clicking the &ldquo;Done&rdquo; button), the editor might still
consider the content empty or unchanged because it relies on its API calls to synchronize and retrieve the final
content (often synchronizing it to a hidden form field). Therefore, merely altering the visual presentation doesn&rsquo;t
guarantee the data will be captured correctly.</p><p>Finally, <strong>instance management</strong> also becomes a factor. On a page containing multiple short-answer questions, each
question&rsquo;s comment box is typically an independent instance of the Rich Text Editor. This means if we want to interact
via API, we must be able to accurately identify and obtain the specific instance object for the editor corresponding to
the question currently being processed. Only then can we call its specific methods (like setting content or focusing).
This undoubtedly increases the complexity of the automation script. The emergence of these issues indicated that direct
DOM manipulation might be insufficient for handling RTE scenarios, necessitating an exploration into using the editor&rsquo;s
API.</p><p>Facing the challenges posed by Rich Text Editors, the natural next step was to attempt interaction using the editor&rsquo;s
own provided API, which is generally the more standardized and reliable method. Taking the common UEditor as an example,
the standard operational workflow typically involves these steps: First, identify the unique identifier of the target
editor container within the page&rsquo;s DOM. This ID is usually associated with the element (sometimes a <code>&lt;script></code> tag,
sometimes the outermost <code>&lt;div></code> rendered by the editor) that the editor was initialized upon. Once this ID is obtained,
one can call UEditor&rsquo;s global method <code>UE.getEditor('editorID')</code> to retrieve the JavaScript instance object for that
specific editor. With this instance object in hand, various methods can be invoked, such as using
<code>editorInstance.setContent('your comment HTML', false)</code> to set the editor&rsquo;s content (where the second argument <code>false</code>
usually means overwriting existing content), or calling <code>editorInstance.focus()</code> to bring focus to the editor. However,
before invoking methods that manipulate content, it&rsquo;s crucial to ensure the editor has fully initialized and is ready to
accept API calls. This is typically achieved using the <code>editorInstance.ready(callback)</code> method, placing the actual
content manipulation code within the provided callback function to avoid errors caused by calling APIs on an
incompletely loaded editor.</p><p>This standard API workflow sounds quite robust and sufficient for interacting with Rich Text Editors. However, theory
and practice sometimes diverge. In our previous automation explorations, both in discussion forum scenarios and during
the current homework grading attempt, trying to interact with UEditor instances via the API led to unexpected and
perplexing difficulties. The primary issue encountered was that <strong>editor instance registration seemed delayed or even
failed entirely</strong>. Using script logic, we could accurately locate the editor&rsquo;s container <code>&lt;div></code> element rendered on the
page, for instance, one with the ID <code>edui78</code>. But subsequent attempts to fetch the instance for this ID using
<code>UE.getEditor('edui78')</code> frequently returned <code>null</code> or <code>undefined</code>, indicating failure. To investigate further, we
examined UEditor&rsquo;s global object <code>UE.instants</code>, which manages all initialized instances, only to be surprised that the
ID <code>edui78</code> we found was <strong>not listed</strong> in this global registry at all! This implied that although the editor was
visually rendered and present on the page, its corresponding JavaScript control instance wasn&rsquo;t being registered in the
expected manner, preventing us from accessing it through the official API.</p><p>Additionally, we sometimes encountered <strong>ID mismatch issues</strong>. In certain situations, the ID under which the editor
instance was actually registered in <code>UE.instants</code> did not match the ID of the outermost container <code>&lt;div></code> rendered on
the page. This meant that even if an instance was successfully registered, we might fail to retrieve it because we were
using the incorrect ID derived from the visible DOM element, further complicating and adding uncertainty to automation
attempts via the API. These practical pitfalls made the seemingly ideal API approach fraught with difficulty.</p><p>After multiple attempts involving increased delays, trying different selectors, and inspecting <code>UE.instants</code>, the
conclusion was clear: <strong>in this specific dynamically loaded context, relying on the UEditor API to inject comments was
unreliable.</strong> The editor&rsquo;s initialization process likely involved some specific mechanism or perhaps a bug that
prevented us from consistently obtaining and controlling the target comment box instance.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Pseudocode Example: Failed API Attempt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>tryApiComment</span>(<span style=color:#a6e22e>questionElement</span>, <span style=color:#a6e22e>commentHtml</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>commentContainer</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>questionElement</span>.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;.comment&#39;</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>editorDiv</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>commentContainer</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;div.edui-editor[id^=&#34;edui&#34;]&#39;</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>editorDiv</span> <span style=color:#f92672>||</span> <span style=color:#f92672>!</span><span style=color:#a6e22e>editorDiv</span>.<span style=color:#a6e22e>id</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;Cannot find editor div&#34;</span>);
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>editorId</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>editorDiv</span>.<span style=color:#a6e22e>id</span>; <span style=color:#75715e>// e.g., &#34;edui78&#34;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Attempting to get editor instance: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>editorId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// **** THE PROBLEM AREA ****
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// Often failed because &#39;edui78&#39; wasn&#39;t registered in UE.instants
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#75715e>// or UE.getEditor returned undefined/null even if the div existed.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>editorInstance</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>editorInstance</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>UE</span>.<span style=color:#a6e22e>getEditor</span>(<span style=color:#a6e22e>editorId</span>); <span style=color:#75715e>// &lt;--- Fails or returns unusable instance
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>editorInstance</span> <span style=color:#f92672>||</span> <span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>editorInstance</span>.<span style=color:#a6e22e>setContent</span> <span style=color:#f92672>!==</span> <span style=color:#e6db74>&#39;function&#39;</span>) {
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>throw</span> <span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#34;Instance invalid or not ready&#34;</span>);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	} <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>e</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>`Failed to get or validate UE instance </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>editorId</span><span style=color:#e6db74>}</span><span style=color:#e6db74>:`</span>, <span style=color:#a6e22e>e</span>);
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#75715e>// **** END PROBLEM AREA ****
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Code below here would likely not be reached or would fail
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>await</span> <span style=color:#66d9ef>new</span> Promise(<span style=color:#a6e22e>resolve</span> =&gt; <span style=color:#a6e22e>editorInstance</span>.<span style=color:#a6e22e>ready</span>(<span style=color:#a6e22e>resolve</span>));
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>editorInstance</span>.<span style=color:#a6e22e>setContent</span>(<span style=color:#a6e22e>commentHtml</span>, <span style=color:#66d9ef>false</span>);
</span></span><span style=display:flex><span>	<span style=color:#75715e>// ... click confirm ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>With the API route seemingly blocked, the only option left was to return to the more &ldquo;primitive&rdquo; method.</p><h2 id=revisiting-dom-manipulation>Revisiting DOM Manipulation<a hidden class=anchor aria-hidden=true href=#revisiting-dom-manipulation>#</a></h2><p>After repeatedly hitting roadblocks while trying to use the editor&rsquo;s API, and facing an editor instance that seemed
uncontrollable through standard means, we had to reconsider our initial approach and <strong>return to the path of direct DOM
manipulation</strong>. This time, however, we needed to learn from past mistakes and make adjustments based on our
understanding of how Rich Text Editors typically function.</p><p>First, the <strong>target of manipulation needed to be more precise</strong>. We knew that the final content displayed by an RTE
usually resides within an <code>&lt;iframe></code> element. Therefore, the script&rsquo;s core task shifted from trying to find and
manipulate a potentially non-existent or inaccessible <code>&lt;textarea></code> to accurately locating this <code>&lt;iframe></code>. It then
needed to delve deeper into its <code>contentDocument</code> to find the actual <code>&lt;body></code> element (often marked with a class like
<code>view</code> and having its <code>contentEditable</code> attribute set to <code>true</code>) which holds the content and allows user editing.</p><p>Second, the <strong>issue of data synchronization</strong> had to be addressed. Since we couldn&rsquo;t reliably find and update the hidden
<code>&lt;textarea></code> that, in theory, should exist for form submission (it either didn&rsquo;t appear as expected or was too deeply
buried by the editor&rsquo;s complex mechanisms), we had to make a <strong>critical, albeit risky, assumption</strong>. We assumed that
when the user (or our script) clicks the &ldquo;Done&rdquo; button associated with the comment box, the page&rsquo;s own JavaScript logic
bound to that button <strong>reads the current content directly from the <code>&lt;iframe></code>&rsquo;s inner <code>&lt;body></code> element</strong>, rather than
from the elusive <code>&lt;textarea></code>. This content would then be used for subsequent processing, such as saving or submitting
the comment. This was undoubtedly an assumption based on observation and reverse-engineering guesswork, but given the
inability to gain control via the editor&rsquo;s instance, it seemed the only viable path forward, albeit tinged with a degree
of uncertainty. This assumption allowed us to bypass the API and simulate comment input by directly modifying the
<code>&lt;iframe></code>&rsquo;s content.</p><p>Based on this key assumption – that the page&rsquo;s &ldquo;Done&rdquo; button reads directly from the <code>&lt;iframe></code> content – we readjusted
the core automation workflow. The general sequence of steps for the script became: first, as before, identify all the
short-answer list item <code>&lt;li></code> elements on the page; next, iterate through these questions sequentially. For each
question, initially locate its score input field, set the desired score (e.g., defaulting to the maximum), and ensure
relevant update events are triggered. Then comes the crucial step: find and simulate a click on that question&rsquo;s "
Comment" button. After clicking, it&rsquo;s vital to <strong>patiently wait</strong>, allowing the page sufficient time to dynamically load
or display the Rich Text Editor&rsquo;s <code>&lt;iframe></code> along with the adjacent &ldquo;Done&rdquo; button. Once these elements appear, the
script concentrates on <strong>finding the target <code>&lt;iframe></code></strong> – typically nested within the editor&rsquo;s main container <code>&lt;div></code> (
perhaps with a class like <code>edui-editor</code>) and possibly having an ID following a pattern (like <code>ueditor_X</code>). Upon
successfully locating the <code>&lt;iframe></code>, the script accesses its <code>contentDocument.body</code> property to get the internal
editable area, and then directly sets the <code>innerHTML</code> property of this area to our predefined comment text. The final
action within the loop is to find and simulate a click on the &ldquo;Done&rdquo; button, thereby triggering the page&rsquo;s own logic for
saving the comment. Naturally, after completing all these steps for one question, incorporating an appropriate delay
before proceeding to the next remains essential for process stability.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Pseudocode Example: Revised DOM Manipulation (Iframe Only)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>commentViaIframe</span>(<span style=color:#a6e22e>questionElement</span>, <span style=color:#a6e22e>commentHtml</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>commentButton</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>questionElement</span>.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;.comment span.modify&#39;</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>commentButton</span>) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>commentButton</span>.<span style=color:#a6e22e>click</span>();
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>delay</span>(<span style=color:#ae81ff>1000</span>); <span style=color:#75715e>// Wait for iframe etc.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>commentContainer</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>questionElement</span>.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;.comment&#39;</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>editorDiv</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>commentContainer</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;div.edui-editor&#39;</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>editorIframe</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>editorDiv</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;iframe[id^=&#34;ueditor_&#34;]&#39;</span>);
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>confirmButton</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>commentContainer</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>querySelector</span>(<span style=color:#e6db74>&#39;div.confirm&#39;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>editorIframe</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>confirmButton</span>) {
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>iframeDoc</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>editorIframe</span>.<span style=color:#a6e22e>contentDocument</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>editorIframe</span>.<span style=color:#a6e22e>contentWindow</span><span style=color:#f92672>?</span>.document;
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>iframeDoc</span><span style=color:#f92672>?</span>.<span style=color:#a6e22e>body</span>) {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>iframeDoc</span>.<span style=color:#a6e22e>body</span>.<span style=color:#a6e22e>innerHTML</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>commentHtml</span>; <span style=color:#75715e>// Set content directly
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Set iframe content for </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>questionElement</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>confirmButton</span>.<span style=color:#a6e22e>click</span>(); <span style=color:#75715e>// Trigger the page&#39;s own logic
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Clicked confirm for </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>questionElement</span>.<span style=color:#a6e22e>id</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>		} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;Could not access iframe body for &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>questionElement</span>.<span style=color:#a6e22e>id</span>);
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;Could not find iframe or confirm button for &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>questionElement</span>.<span style=color:#a6e22e>id</span>);
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Surprisingly, this approach of &ldquo;modify only the iframe, ignore the textarea&rdquo; <strong>actually worked</strong> on our target page!
This implied that the &ldquo;Done&rdquo; button&rsquo;s click event handler indeed read the content from the <code>&lt;iframe></code> to save the
comment, without requiring us to manually sync the mysterious (or perhaps non-existent) <code>&lt;textarea></code>. It was a welcome
breakthrough.</p><h2 id=introducing-ai-for-personalized-comments>Introducing AI for Personalized Comments<a hidden class=anchor aria-hidden=true href=#introducing-ai-for-personalized-comments>#</a></h2><p>Having solved the basic operational simulation, the next goal was to make the comments less repetitive. Generating
comments based on the student&rsquo;s specific answer would make the process more intelligent.</p><p>This naturally led to considering Large Language Models (LLMs). Several excellent models are available, including
Baidu&rsquo;s Ernie series in China. They provide APIs that allow sending requests (containing information like the question,
student answer, etc.) to receive model-generated content, such as the comments we needed.</p><h3 id=choosing-the-model>Choosing the Model<a hidden class=anchor aria-hidden=true href=#choosing-the-model>#</a></h3><p>Considering the potential need to process numerous questions during grading, response speed was a requirement. At the
same time, the task of generating a short comment is relatively simple. We opted for the Ernie Speed model from the
Ernie family, as it offered a good balance between speed and performance for this task.</p><h3 id=api-call-workflow>API Call Workflow<a hidden class=anchor aria-hidden=true href=#api-call-workflow>#</a></h3><p>To interact with the AI model, a typical API call process involves two main steps. The first is <strong>obtaining an
authorization credential</strong>, known as an <code>access_token</code>. This requires making a request to the platform&rsquo;s OAuth
authentication endpoint, passing along the API Key (AK) and Secret Key (SK) obtained from the platform registration.
Upon successful authentication, the endpoint returns an <code>access_token</code> string, which usually has an expiration period (
e.g., 30 days). This token acts like a temporary passport, credentialing subsequent interactions with the specific AI
model services.</p><p>Once a valid <code>access_token</code> is acquired, the second step is to <strong>call the specific AI model&rsquo;s dialogue interface</strong>, such
as the Ernie Speed Chat API. This is typically a POST request sent to an endpoint URL that includes the obtained
<code>access_token</code> as a parameter. The request body must be structured according to the API&rsquo;s specifications. The core
component is the <code>messages</code> field, an array representing the conversation history, which must contain at least one
message with <code>role: "user"</code>. The <code>content</code> of this user message is our carefully crafted <strong>prompt</strong>, containing the
question, student&rsquo;s answer, and instructions for the AI comment generation. Additionally, an optional <code>system</code> field can
be included to define the AI&rsquo;s role and provide global instructions (e.g., &ldquo;You are a university TA generating
comments&rdquo;). Depending on the need, other parameters like <code>temperature</code> or <code>top_p</code> can be added to control the diversity
and randomness of the generated output. Upon receiving the request, the AI model processes the input based on the
<code>messages</code> and <code>system</code> prompt and returns the generated result.</p><h3 id=cross-origin-issues-cors>Cross-Origin Issues (CORS)<a hidden class=anchor aria-hidden=true href=#cross-origin-issues-cors>#</a></h3><p>Attempting to call external APIs (like <code>https://aip.baidubce.com</code>) directly from browser console scripts or standard
webpage JavaScript using <code>fetch</code> or <code>XMLHttpRequest</code> immediately runs into <strong>CORS (Cross-Origin Resource Sharing)</strong>
issues. For security reasons, browsers block such cross-domain requests by default, unless the target server explicitly
permits them via specific response headers (like <code>Access-Control-Allow-Origin</code>). Baidu&rsquo;s API endpoints, being primarily
designed for server-to-server communication, usually do not send the necessary headers to allow direct requests from
arbitrary web origins.</p><p>The browser console will explicitly state the block:</p><pre tabindex=0><code>Access to fetch at &#39;https://aip.baidubce.com/...&#39; from origin &#39;http://...&#39; has been blocked by CORS policy...
</code></pre><h3 id=the-tampermonkey-solution>The Tampermonkey Solution<a hidden class=anchor aria-hidden=true href=#the-tampermonkey-solution>#</a></h3><p>Userscript managers like Tampermonkey provide a privileged channel: the <code>GM_xmlhttpRequest</code> function. Code running
within a userscript environment can use this function to make cross-domain requests because the request originates from
the browser extension itself, not the webpage&rsquo;s restricted context, thus bypassing standard CORS limitations.</p><p>However, using this powerful function requires attention to a few key details to ensure the script works correctly and
has the necessary permissions. Firstly, <strong>explicit authorization must be declared in the script&rsquo;s metadata block</strong> (the
section starting with <code>// ==UserScript==</code> and ending with <code>// ==/UserScript==</code>). A line <code>// @grant GM_xmlhttpRequest</code>
must be included, essentially informing Tampermonkey: &ldquo;This script needs permission to make cross-domain requests.&rdquo;
Without this declaration, attempts to call the function will fail.</p><p>Secondly, for security purposes, Tampermonkey usually requires the script to <strong>explicitly declare the external domains
it intends to connect to</strong>. Therefore, within the same metadata block, a declaration like <code>// @connect aip.baidubce.com</code>
is needed, specifying that the script will communicate with Baidu&rsquo;s AI platform API server. This declaration helps users
understand the script&rsquo;s network activity and allows the script manager to enforce finer-grained permissions.</p><p>Lastly, it&rsquo;s crucial to understand that <code>GM_xmlhttpRequest</code> is inherently an <strong>asynchronous operation</strong>. This means that
after initiating a request, the script execution doesn&rsquo;t pause to wait for the response; it continues with the
subsequent code. Consequently, handling the request&rsquo;s outcome requires using asynchronous programming patterns. Common
approaches include providing callback functions to <code>GM_xmlhttpRequest</code>—such as <code>onload</code> for successful responses,
<code>onerror</code> for network or other errors, and <code>ontimeout</code> for timeouts. A more modern and often more manageable approach
for complex workflows involves wrapping the <code>GM_xmlhttpRequest</code> call within a JavaScript <code>Promise</code> object, which then
allows the use of <code>async/await</code> syntax. This makes the asynchronous code appear more like synchronous code, leading to
clearer logic for sending requests and processing their results.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Pseudocode Example: Using GM_xmlhttpRequest for Token
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getAccessTokenGM</span>(<span style=color:#a6e22e>apiKey</span>, <span style=color:#a6e22e>secretKey</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>url</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`https://aip.baidubce.com/oauth/2.0/token?grant_type=client_credentials&amp;client_id=</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>apiKey</span><span style=color:#e6db74>}</span><span style=color:#e6db74>&amp;client_secret=</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>secretKey</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> Promise((<span style=color:#a6e22e>resolve</span>, <span style=color:#a6e22e>reject</span>) =&gt; {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>GM_xmlhttpRequest</span>({
</span></span><span style=display:flex><span>			                  <span style=color:#a6e22e>method</span>   <span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;POST&#34;</span>,
</span></span><span style=display:flex><span>			                  <span style=color:#a6e22e>url</span>      <span style=color:#f92672>:</span> <span style=color:#a6e22e>url</span>,
</span></span><span style=display:flex><span>			                  <span style=color:#a6e22e>headers</span>  <span style=color:#f92672>:</span> {<span style=color:#e6db74>&#34;Content-Type&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/json&#34;</span>, <span style=color:#e6db74>&#34;Accept&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;application/json&#34;</span>},
</span></span><span style=display:flex><span>			                  <span style=color:#a6e22e>onload</span>   <span style=color:#f92672>:</span> <span style=color:#66d9ef>function</span> (<span style=color:#a6e22e>response</span>) {
</span></span><span style=display:flex><span>				                  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span> <span style=color:#f92672>===</span> <span style=color:#ae81ff>200</span>) {
</span></span><span style=display:flex><span>					                  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>data</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>responseText</span>);
</span></span><span style=display:flex><span>					                  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>access_token</span>) {
</span></span><span style=display:flex><span>						                  <span style=color:#a6e22e>resolve</span>(<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>access_token</span>);
</span></span><span style=display:flex><span>					                  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>						                  <span style=color:#a6e22e>reject</span>(<span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#34;Token not found in response&#34;</span>));
</span></span><span style=display:flex><span>					                  }
</span></span><span style=display:flex><span>				                  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>					                  <span style=color:#a6e22e>reject</span>(<span style=color:#66d9ef>new</span> Error(<span style=color:#e6db74>&#34;HTTP error getting token: &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>status</span>));
</span></span><span style=display:flex><span>				                  }
</span></span><span style=display:flex><span>			                  },
</span></span><span style=display:flex><span>			                  <span style=color:#a6e22e>onerror</span>  <span style=color:#f92672>:</span> <span style=color:#a6e22e>reject</span>,
</span></span><span style=display:flex><span>			                  <span style=color:#a6e22e>ontimeout</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>reject</span>
</span></span><span style=display:flex><span>		                  });
</span></span><span style=display:flex><span>	});
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>With CORS issues resolved, we could now communicate freely with the AI from within the script.</p><h2 id=prompt-engineering-and-json-agreement>Prompt Engineering and JSON Agreement<a hidden class=anchor aria-hidden=true href=#prompt-engineering-and-json-agreement>#</a></h2><p>Simply being able to call the AI wasn&rsquo;t enough; the key was instructing it effectively to get the desired output. This
is where <strong>Prompt Engineering</strong> comes in.</p><h3 id=initial-prompt>Initial Prompt<a hidden class=anchor aria-hidden=true href=#initial-prompt>#</a></h3><p>Initially, one might just concatenate the question and student answer into the prompt and let the AI write a comment
freely.</p><pre tabindex=0><code>Question: Please explain the function of an empty shot (kūjìngtóu).
Student Answer: Empty shots can establish the environment and transition time/space.
Please provide a one-sentence comment:
</code></pre><p>This might yield a comment like, &ldquo;The answer is basically correct, but not comprehensive enough,&rdquo; which is a decent
start.</p><h3 id=adding-more-context>Adding More Context<a hidden class=anchor aria-hidden=true href=#adding-more-context>#</a></h3><p>Providing only the question and student&rsquo;s answer, while capable of generating a basic comment, might lack the nuance
needed for more accurate evaluation. To enhance the AI&rsquo;s assessment capabilities, we can <strong>enrich the prompt with
additional contextual information</strong>. For instance, including the <strong>correct answer</strong> explicitly allows the AI to know the
standard benchmark. Similarly, providing the official <strong>answer analysis</strong> or grading rubric, if available on the page,
helps the AI better grasp the question&rsquo;s intended focus and evaluation criteria. Furthermore, informing the AI about the
<strong>maximum score</strong> for the question gives it a sense of the grading scale, potentially leading to more reasonable score
suggestions if we later task it with assisting in grading. By integrating these extra pieces of information, we
construct a more comprehensive prompt, guiding the AI towards making more precise and well-founded judgments and
comments.</p><pre tabindex=0><code>You are a university teaching assistant. Please evaluate the student&#39;s answer based on the following information and provide a concise comment:

Question (Max Score: 8 points):
What are the specific functions and artistic values of an empty shot (kūjìngtóu)?

Student Answer:
(1) Establish the story environment (2) Serve as a means of spatiotemporal transition

Correct Answer Reference:
(1) Establish the story environment (2) Serve as a means of spatiotemporal transition (3) Render atmosphere, enhance emotion (4) Create artistic conception (yìjìng)

Answer Analysis Reference:
An empty shot is one containing only scenery, no characters... It serves multiple expressive functions and artistic values, specifically in four aspects.

Comment:
</code></pre><p>This allows the AI to more clearly see which points the student covered and which were missed.</p><h3 id=defining-output-format-json>Defining Output Format (JSON)<a hidden class=anchor aria-hidden=true href=#defining-output-format-json>#</a></h3><p>Free-text comments still require the script to parse them. What if we also want the AI to suggest a score? Including the
score directly within the comment makes parsing more difficult and error-prone. A better approach is to have the AI
return <strong>structured data</strong>, such as JSON.</p><p>This requires modifying the <strong>System Prompt</strong> (global role/instructions for the AI) and the <strong>User Prompt</strong> (specific
request) to explicitly ask for a JSON object in a specific format:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Example System Prompt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>DEFAULT_SYSTEM_PROMPT</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>You are a university teaching assistant grading homework.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Based on the provided context, evaluate the student&#39;s answer.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Respond ONLY with a JSON object containing two keys:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>1.  &#34;score&#34;: A numerical score between 0 and the Maximum Score (inclusive).
</span></span></span><span style=display:flex><span><span style=color:#e6db74>2.  &#34;comment&#34;: A brief, positive, and constructive comment (max 25 characters).
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Example Response Format:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>{
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;score&#34;: 10,
</span></span></span><span style=display:flex><span><span style=color:#e6db74>  &#34;comment&#34;: &#34;Accurate answer, key points clear.&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Do NOT include any other text or markdown formatting.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>`</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Example User Prompt (used with the System Prompt)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>userPrompt</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Question (Max Score: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>maxScore</span><span style=color:#e6db74>}</span><span style=color:#e6db74> points):
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#a6e22e>questionText</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Student Answer:
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#a6e22e>studentAnswerText</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Correct Answer Reference:
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#a6e22e>correctAnswerText</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;None provided&#34;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Answer Analysis Reference:
</span></span></span><span style=display:flex><span><span style=color:#e6db74></span><span style=color:#e6db74>${</span><span style=color:#a6e22e>analysisText</span> <span style=color:#f92672>||</span> <span style=color:#e6db74>&#34;None provided&#34;</span><span style=color:#e6db74>}</span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>Based on the information above, please return ONLY the JSON object with the score and comment:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>`</span>;
</span></span></code></pre></div><p>Additionally, when calling the API, if the specific endpoint supports it (like some newer Ernie API versions), one might
try adding the <code>"response_format": "json_object"</code> parameter to further enforce the JSON output structure.</p><h3 id=parsing-and-application>Parsing and Application<a hidden class=anchor aria-hidden=true href=#parsing-and-application>#</a></h3><p>Upon receiving the <code>result</code> string containing the AI&rsquo;s response, the script needs to perform several processing steps
before the information can be applied to the webpage. First, since AIs sometimes wrap JSON strings in markdown code
block markers (like <code>```json ... ```</code>), an <strong>optional cleanup step</strong> is necessary to remove these extraneous
characters, yielding a clean JSON string.</p><p>The next critical step is <strong>parsing</strong>. Using JavaScript&rsquo;s built-in <code>JSON.parse()</code> method, this cleaned string is
converted into a standard JavaScript object. If the AI adhered to the instructions, this object should contain the
expected keys, such as <code>score</code> and <code>comment</code>.</p><p>However, trusting external service responses implicitly is unwise, making <strong>validation</strong> an essential part of the
process. The script must check if the parsed object actually contains both the <code>score</code> and <code>comment</code> properties. For the
<code>score</code>, further validation is needed to ensure its value is a valid number and falls within the acceptable range (e.g.,
greater than or equal to 0 and less than or equal to the question&rsquo;s maximum score). For the <code>comment</code>, a simple check
for a non-empty string might suffice.</p><p>Only after passing these validation checks can the results be confidently <strong>applied</strong> to the user interface. The
validated score is inserted into the corresponding question&rsquo;s score input field, and the retrieved comment is written
into the comment textarea using the previously determined DOM manipulation method (which might involve clicking "
Comment," finding the textarea, setting its value, and then clicking &ldquo;Done&rdquo;). If issues arise during parsing or
validation (e.g., the response isn&rsquo;t valid JSON, or the score is out of range), the script should implement appropriate
error handling, such as logging a warning and populating the comment field with a default message indicating failure or
invalidity.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Pseudocode: Handling AI JSON Response
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>async</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>handleAiResponse</span>(<span style=color:#a6e22e>aiResultString</span>, <span style=color:#a6e22e>scoreInput</span>, <span style=color:#a6e22e>commentArea</span>, <span style=color:#a6e22e>confirmButton</span>, <span style=color:#a6e22e>maxScore</span>) {
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>score</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>comment</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;(Failed to process comment)&#34;</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>		<span style=color:#75715e>// Clean potential markdown backticks
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>cleanedString</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>aiResultString</span>.<span style=color:#a6e22e>replace</span>(<span style=color:#e6db74>/^```json\s*|```$/g</span>, <span style=color:#e6db74>&#39;&#39;</span>).<span style=color:#a6e22e>trim</span>();
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>result</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>JSON</span>.<span style=color:#a6e22e>parse</span>(<span style=color:#a6e22e>cleanedString</span>);
</span></span><span style=display:flex><span>		<span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>result</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>score</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;number&#39;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#66d9ef>typeof</span> <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>comment</span> <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;string&#39;</span>) {
</span></span><span style=display:flex><span>			<span style=color:#75715e>// Validate score
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>potentialScore</span> <span style=color:#f92672>=</span> parseFloat(<span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>score</span>);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>maxScoreNum</span> <span style=color:#f92672>=</span> parseFloat(<span style=color:#a6e22e>maxScore</span>);
</span></span><span style=display:flex><span>			<span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>isNaN(<span style=color:#a6e22e>potentialScore</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>!</span>isNaN(<span style=color:#a6e22e>maxScoreNum</span>) <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>potentialScore</span> <span style=color:#f92672>&gt;=</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>potentialScore</span> <span style=color:#f92672>&lt;=</span> <span style=color:#a6e22e>maxScoreNum</span>) {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>score</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>potentialScore</span>;
</span></span><span style=display:flex><span>			} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>warn</span>(<span style=color:#e6db74>`Invalid score from AI: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>score</span><span style=color:#e6db74>}</span><span style=color:#e6db74>, Max: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>maxScore</span><span style=color:#e6db74>}</span><span style=color:#e6db74>. Defaulting to 0.`</span>);
</span></span><span style=display:flex><span>				<span style=color:#a6e22e>comment</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>`(Invalid Score) </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>comment</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>; <span style=color:#75715e>// Prepend warning
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>			}
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>comment</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>result</span>.<span style=color:#a6e22e>comment</span>; <span style=color:#75715e>// Use AI comment regardless of score validity (unless invalid JSON)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>		} <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>warn</span>(<span style=color:#e6db74>&#34;AI response is not valid JSON or missing keys:&#34;</span>, <span style=color:#a6e22e>result</span>);
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>comment</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;(Invalid comment format)&#34;</span>;
</span></span><span style=display:flex><span>		}
</span></span><span style=display:flex><span>	} <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>e</span>) {
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#e6db74>&#34;Error parsing AI JSON response:&#34;</span>, <span style=color:#a6e22e>e</span>, <span style=color:#a6e22e>aiResultString</span>);
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>comment</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;(Error parsing comment)&#34;</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#75715e>// Apply to UI
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>scoreInput</span>) <span style=color:#a6e22e>scoreInput</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>score</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>commentArea</span>) <span style=color:#a6e22e>commentArea</span>.<span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>comment</span>;
</span></span><span style=display:flex><span>	<span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>confirmButton</span>) <span style=color:#a6e22e>confirmButton</span>.<span style=color:#a6e22e>click</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#e6db74>`Applied Score: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>score</span><span style=color:#e6db74>}</span><span style=color:#e6db74>, Comment: </span><span style=color:#e6db74>${</span><span style=color:#a6e22e>comment</span><span style=color:#e6db74>}</span><span style=color:#e6db74>`</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=integration-results-and-reflections>Integration, Results, and Reflections<a hidden class=anchor aria-hidden=true href=#integration-results-and-reflections>#</a></h2><p>Bringing together precise DOM manipulation, cross-domain API calls via Tampermonkey, essential data extraction,
carefully designed AI interaction (including prompt engineering and JSON parsing), and a user-friendly trigger button
resulted in a functional Tampermonkey script for assisted grading. Key to its success were crucial design principles: *
<em>asynchronous flow control</em>* using <code>async/await</code> to manage network requests and delays sequentially; robust <strong>error
handling</strong> with <code>try...catch</code> to prevent single failures from stopping the entire process; an enhanced **user experience
** through SweetAlert for confirmations and feedback; modular <strong>code organization</strong> into functions for readability and
maintenance; <strong>on-demand execution</strong> via a button click for user control; and a constant awareness of <strong>security
implications</strong>, limiting the script&rsquo;s use to personal, trusted environments due to the client-side handling of API keys.</p><p>While this script demonstrably cannot replace a teacher&rsquo;s nuanced judgment or personalized feedback, it effectively met
its primary objective: <strong>significantly reducing repetitive workload</strong>. It provides <strong>preliminary AI-suggested scores</strong> (
defaulting to the max or using parsed JSON values), requiring only teacher review and adjustment. It <strong>automatically
generates basic comments</strong> based on AI analysis, serving as a starting point for faster feedback. Most importantly, it
enables <strong>batch processing</strong>, handling all short-answer questions on the page sequentially with a single click, saving
considerable time.</p><p>This project offered profound insights into the <strong>complexity of real-world web applications</strong>, where dynamic loading and
third-party components often complicate standard approaches, sometimes making direct DOM manipulation a necessary, if
potentially fragile, alternative to unreliable APIs. It also clearly defined the <strong>boundaries of automation</strong>;
technology excels at efficiency and repetitive tasks but cannot replicate the deep understanding and empathy required
for high-quality educational feedback – the goal must be assistance, not replacement. Furthermore, the experience
underscored the <strong>critical role of prompt engineering</strong> in effectively communicating intent to AI and the value of
structuring requests for predictable, usable output like JSON. Finally, it served as a potent reminder about <strong>security
consciousness</strong> when handling sensitive credentials in client-side scripts.</p><p>In conclusion, though a modest personal project, the journey of tackling these challenges and creating a genuinely
helpful tool for family was deeply rewarding. Hopefully, sharing this exploration offers some practical insights. If you
undertake a similar project, remember to <strong>analyze your specific target platform meticulously</strong>, always <strong>prioritize
security</strong> (especially with API keys), and <strong>embrace the debugging process</strong> using your browser&rsquo;s developer tools.
Often, the true joy of coding lies in overcoming these practical hurdles and making tangible, positive changes in
everyday life. Thank you for reading!</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://tategotoazarasi.github.io/en/tags/tampermonkey/>Tampermonkey</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/userscript/>Userscript</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/ai/>Ai</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/baidu-ernie/>Baidu-Ernie</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/llm/>Llm</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/homework-grading/>Homework-Grading</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/grading-automation/>Grading-Automation</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/education-technology/>Education-Technology</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/edtech/>Edtech</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/javascript/>Javascript</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/dom-manipulation/>Dom-Manipulation</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/api-integration/>Api-Integration</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/gm-xmlhttprequest/>Gm-Xmlhttprequest</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/cors-workaround/>Cors-Workaround</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/prompt-engineering/>Prompt-Engineering</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/json/>Json</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/browser-automation/>Browser-Automation</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/teacher-tools/>Teacher-Tools</a></li></ul><nav class=paginav><a class=prev href=https://tategotoazarasi.github.io/en/posts/delving-into-anki-cards-demystifying-templates-for-data-extraction-and-practical-application/><span class=title>« Prev</span><br><span>Delving into Anki Cards: Demystifying Templates for Data Extraction and Practical Application</span>
</a><a class=next href=https://tategotoazarasi.github.io/en/posts/matrix-multiplication-performance-benchmark-from-triple-loops-to-100-plus-gflops-on-amd-ryzen-ai-radeon/><span class=title>Next »</span><br><span>Matrix Multiplication Performance Benchmark: from Triple Loops to 100+ GFLOPS on AMD Ryzen AI + Radeon</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://tategotoazarasi.github.io/en/>Tategoto Azarasi</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>