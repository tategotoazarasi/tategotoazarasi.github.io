<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Dev Log: Adding a All-in-One Widget to Breezy Weather - The ClockDayHourWeekWidget Journey | Tategoto Azarasi</title>
<meta name=keywords content="breezy-weather,android-widget,clock-day-hour-week,appwidgetprovider,remoteviews,widget-development,open-source,weather-app,kotlin,android-development,breezy-weather-widget,android-app-widget,clock-widget,hourly-forecast,daily-forecast,widget-config,remoteviews-presenter,android-layout,sharedpreferences,pendingintent"><meta name=description content="A detailed guide on adding a comprehensive &ldquo;ClockDayHourWeekWidget&rdquo; to the Breezy Weather app, combining clock, daily, and hourly forecasts into one Android widget."><meta name=author content="Tategoto Azarasi"><link rel=canonical href=https://tategotoazarasi.github.io/en/posts/clock-day-hour-week-widget/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://tategotoazarasi.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://tategotoazarasi.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://tategotoazarasi.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://tategotoazarasi.github.io/apple-touch-icon.png><link rel=mask-icon href=https://tategotoazarasi.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://tategotoazarasi.github.io/en/posts/clock-day-hour-week-widget/><link rel=alternate hreflang=zh href=https://tategotoazarasi.github.io/zh/posts/clock-day-hour-week-widget/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link crossorigin=anonymous href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ rel=stylesheet><script crossorigin=anonymous defer integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js></script><script crossorigin=anonymous defer integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR onload=renderMathInElement(document.body) src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js></script>>
<script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><meta property="og:url" content="https://tategotoazarasi.github.io/en/posts/clock-day-hour-week-widget/"><meta property="og:site_name" content="Tategoto Azarasi"><meta property="og:title" content="Dev Log: Adding a All-in-One Widget to Breezy Weather - The ClockDayHourWeekWidget Journey"><meta property="og:description" content="A detailed guide on adding a comprehensive “ClockDayHourWeekWidget” to the Breezy Weather app, combining clock, daily, and hourly forecasts into one Android widget."><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-30T16:40:50+08:00"><meta property="article:modified_time" content="2025-03-30T16:40:50+08:00"><meta property="article:tag" content="Breezy-Weather"><meta property="article:tag" content="Android-Widget"><meta property="article:tag" content="Clock-Day-Hour-Week"><meta property="article:tag" content="Appwidgetprovider"><meta property="article:tag" content="Remoteviews"><meta property="article:tag" content="Widget-Development"><meta name=twitter:card content="summary"><meta name=twitter:title content="Dev Log: Adding a All-in-One Widget to Breezy Weather - The ClockDayHourWeekWidget Journey"><meta name=twitter:description content="A detailed guide on adding a comprehensive &ldquo;ClockDayHourWeekWidget&rdquo; to the Breezy Weather app, combining clock, daily, and hourly forecasts into one Android widget."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://tategotoazarasi.github.io/en/posts/"},{"@type":"ListItem","position":2,"name":"Dev Log: Adding a All-in-One Widget to Breezy Weather - The ClockDayHourWeekWidget Journey","item":"https://tategotoazarasi.github.io/en/posts/clock-day-hour-week-widget/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Dev Log: Adding a All-in-One Widget to Breezy Weather - The ClockDayHourWeekWidget Journey","name":"Dev Log: Adding a All-in-One Widget to Breezy Weather - The ClockDayHourWeekWidget Journey","description":"A detailed guide on adding a comprehensive \u0026ldquo;ClockDayHourWeekWidget\u0026rdquo; to the Breezy Weather app, combining clock, daily, and hourly forecasts into one Android widget.","keywords":["breezy-weather","android-widget","clock-day-hour-week","appwidgetprovider","remoteviews","widget-development","open-source","weather-app","kotlin","android-development","breezy-weather-widget","android-app-widget","clock-widget","hourly-forecast","daily-forecast","widget-config","remoteviews-presenter","android-layout","sharedpreferences","pendingintent"],"articleBody":"I was tinkering with Breezy Weather, the open-source weather app, the other day. It’s got a decent collection of widgets, but I felt like something was missing – one of those “kitchen sink” widgets that just throws everything you need onto your home screen. You know, the current time, what the weather’s doing right now, what it’s gonna do in the next few hours, AND the outlook for the next few days. I got tired of either opening the app or juggling multiple widgets to get the full picture. Naturally, the itch to code kicked in, and I decided to build it myself. Let’s call it the ClockDayHourWeekWidget.\nThis blog post is basically my development log. I’m jotting down the thought process, the steps I took, and a few bumps I hit along the way. It’s mainly for my future self, but hopefully, it might be useful for anyone else interested in Android widget development or maybe even contributing to Breezy Weather. The style’s going to be pretty casual – think of it as dev notes – but I’ll make sure to include the key technical bits and enough code snippets so you can understand what’s going on and potentially replicate it.\nThe Goal:\nCreate a new Android App Widget that displays:\nCurrent Time: Just like your standard clock. Current Weather: Icon, location name, current temperature. Hourly Forecast: A glimpse of the weather (icon, time, temp) for the next few hours (e.g., the next 5). Daily Forecast: The usual suspects (icon, day of the week, high/low temp) for the next few days (e.g., the next 5). Configurability: Following the Breezy Weather pattern, allow users to customize background style, transparency, text color, text size, clock font, etc., via a configuration screen. Alright, goal set. Let’s dive in!\n1. The Big Picture: Standing on the Shoulders of Giants Thankfully, Breezy Weather has a pretty well-defined structure, especially for adding new widgets. Looking at existing files like WidgetClockDayWeekProvider.kt and HourlyTrendWidgetIMP.kt, the pattern becomes clear. To add a new widget, you generally need these pieces:\nAppWidgetProvider (e.g., XxxWidgetProvider.kt): This is the widget’s entry point. It extends AppWidgetProvider and receives system broadcasts, most importantly onUpdate. Its main job is to kick off the real work of loading data and updating the view. Widget Implementation (e.g., XxxWidgetIMP.kt): Often an object (Kotlin singleton) inheriting from AbstractRemoteViewsPresenter. This is where the magic happens: fetching data, loading user configuration, building the RemoteViews object (which defines the widget’s UI), and handling click intents. Configuration Activity (e.g., XxxWidgetConfigActivity.kt): An Activity extending AbstractWidgetConfigActivity. It pops up when the user adds the widget, allowing them to customize its appearance ( background, colors, etc.). It also needs to show a live preview of the settings. XML Layout Files (widget_xxx.xml, widget_xxx_card.xml): These define the static structure of the widget’s UI. Typically, there’s a version without a background card and one with it. Widget Definition XML (xml/widget_xxx.xml, xml/v28/widget_xxx.xml): This metadata file tells the Android system about the widget – its minimum size, preview image, the configuration activity to launch, update frequency ( usually 0 here, as updates are triggered programmatically), etc. The v28 version usually adds widgetFeatures=\"reconfigurable\". Resource Updates: You’ll need to touch several resource files: dimens.xml: Possibly define new dimensions if needed. keys.xml: Add a unique SharedPreferences key for storing the widget’s settings. strings.xml: Add the user-visible name for the widget. AndroidManifest.xml: Register the new Provider and Config Activity. Widgets.kt: Add unique request codes for PendingIntents. Basically, follow this recipe, create or modify each part, and voilà – a new widget is born. For our ClockDayHourWeekWidget, the existing ClockDayWeekWidget is a great starting point. It already handles the clock, date, current weather, and daily forecast. Our main task is to surgically insert the “hourly forecast” section into it.\n2. Getting Our Hands Dirty: Creating the Components Let’s build this thing piece by piece.\n1. Widget Provider (ClockDayHourWeekWidgetProvider.kt) This one’s relatively straightforward. We can copy WidgetClockDayWeekProvider.kt and make a few tweaks:\nRename the class to ClockDayHourWeekWidgetProvider. Inside the onUpdate method, make sure it calls the updateWidgetView method of our new implementation class, ClockDayHourWeekWidgetIMP. Key Point: When calling weatherRepository.getWeatherByLocationId, we absolutely must set both withDaily = true and withHourly = true. Our widget needs both sets of forecast data. // src/main/java/org/breezyweather/background/receiver/widget/ClockDayHourWeekWidgetProvider.kt package org.breezyweather.background.receiver.widget // ... other imports ... import org.breezyweather.remoteviews.presenters.ClockDayHourWeekWidgetIMP // Reference the new IMP import javax.inject.Inject @AndroidEntryPoint // Hilt annotation is crucial class ClockDayHourWeekWidgetProvider : AppWidgetProvider() { @Inject lateinit var locationRepository: LocationRepository @Inject lateinit var weatherRepository: WeatherRepository @OptIn(DelicateCoroutinesApi::class) // Note: Using GlobalScope here, a common but not ideal practice in Providers override fun onUpdate( context: Context, appWidgetManager: AppWidgetManager, appWidgetIds: IntArray, ) { super.onUpdate(context, appWidgetManager, appWidgetIds) // Check if any widget of this type is still in use if (ClockDayHourWeekWidgetIMP.isInUse(context)) { // Launch a coroutine on the IO dispatcher to fetch data GlobalScope.launch(Dispatchers.IO) { // Get the first location (without parameters) val location = locationRepository.getFirstLocation(withParameters = false) // Call the IMP to update the view ClockDayHourWeekWidgetIMP.updateWidgetView( context, location?.copy( // Use copy to create a new object and fill in the weather weather = weatherRepository.getWeatherByLocationId( location.formattedId, withDaily = true, // Needed for daily data (isDaylight, daily forecast) withHourly = true, // !! Must be true, we need hourly data !! withMinutely = false, withAlerts = false ) ) ) } } } } A quick note on GlobalScope.launch(Dispatchers.IO): In the onUpdate method of an AppWidgetProvider, which runs on the main thread and has a short lifespan, this is a fairly common way to handle potentially long-running operations like network requests or database access. While GlobalScope isn’t generally recommended (its coroutines are tied to the application’s lifecycle and harder to manage), it’s a simpler solution in this specific context. More robust approaches might involve goAsync() paired with a Hilt-injected CoroutineScope or even WorkManager, but sticking to the existing pattern keeps things simpler here.\n2. Widget Implementation (ClockDayHourWeekWidgetIMP.kt) This is the beast. Most of the UI construction logic lives here. Again, copying ClockDayWeekWidgetIMP.kt gives us a solid foundation to build upon.\nIts Main Responsibilities:\nupdateWidgetView: Called by the Provider. Gets the config, calls getRemoteViews to build the UI, and finally updates the widget via AppWidgetManager. getRemoteViews: The core method. Takes Context, Location data, and various config parameters, returning a fully constructed RemoteViews object. isInUse: Checks if any instances of this specific widget type exist. setOnClickPendingIntent: Sets up the actions (like opening the app or calendar) when users click on different parts of the widget. Breaking Down getRemoteViews:\nGet Config \u0026 Colors: Use getWidgetConfig to load saved settings and initialize WidgetColor to handle color logic based on config and day/night status.\nChoose Layout: Based on WidgetColor’s judgment (whether to show a card background), load either R.layout.widget_clock_day_hour_week or R.layout.widget_clock_day_hour_week_card.\nPrepare Data: Extract weather data from the Location object, get instances of SettingsManager, ResourcesProviderFactory, etc.\nPopulate Sections (using views.setXXX methods):\nClock: Set the TextClock timezone (setTimeZone). Control the visibility (setViewVisibility) of the different font-styled TextClock views based on the clockFont config. Date: Set the TextClock timezone and date format (setCharSequence with format12Hour/format24Hour). Current Weather: Icon: Get the icon URI using ResourceHelper.getWidgetNotificationIconUri and set it with setImageViewUri. Handle potential nulls (weather.current or weatherCode) by hiding the view ( setViewVisibility(View.INVISIBLE)). Alternate Calendar: Set the TextView text based on CalendarHelper settings and the hideAlternateCalendar config. Place \u0026 Current Temp: Concatenate the strings and set the text for the corresponding TextView. Hourly Forecast (The New Bit): This is the core addition. We need the LinearLayout container designated for the hourly forecast in our layout. Define an array of IDs to easily access the time TextView, temperature TextView, and weather ImageView for each hourly item. Get the weather.nextHourlyForecast list, limiting it to a maximum number (e.g., MAX_HOURLY_ITEMS = 5). Loop Through Data: Iterate min(MAX_HOURLY_ITEMS, weather.nextHourlyForecast.size) times. Get the HourlyForecast object for the current hour. Set the time TextView’s text (using hourly.date.getHour(location, context)). Set the temperature TextView’s text (using temperatureUnit.getShortValueText), handling potential nulls. Set the weather ImageView’s icon (using ResourceHelper.getWidgetNotificationIconUri), again handling potential nulls for weatherCode and using hourly.isDaylight to pick the correct day/night icon. Control Visibility: Ensure this forecast item is visible (setVisibility(View.VISIBLE)). Handle Excess Views: For any placeholder views in the layout beyond the available data (e.g., layout has 5 slots, API gives 3 hours), hide them (setVisibility(View.GONE)). It’s best to hide the entire parent LinearLayout or RelativeLayout for that item. Container Visibility: If there’s no hourly data at all (hourlyItemCount == 0), hide the entire hourly forecast container LinearLayout (widget_clock_day_hour_week_hourly_container). // Inside ClockDayHourWeekWidgetIMP.kt -\u003e getRemoteViews() (Hourly Forecast Snippet) // --- Hourly Forecast --- val hourlyIds = arrayOf( // ... (Define 2D array of TextView and ImageView IDs) ... arrayOf(R.id.widget_clock_day_hour_week_hour_time_1, R.id.widget_clock_day_hour_week_hour_temp_1, R.id.widget_clock_day_hour_week_hour_icon_1), // ... other hours ... ) val hourlyItemCount = min(MAX_HOURLY_ITEMS, weather.nextHourlyForecast.size) hourlyIds.forEachIndexed { i, hourlyId -\u003e if (i \u003c hourlyItemCount) { val hourly = weather.nextHourlyForecast[i] views.setTextViewText(hourlyId[0], hourly.date.getHour(location, context)) // Set time views.setTextViewText( hourlyId[1], // Set temperature hourly.temperature?.temperature?.let { temperatureUnit.getShortValueText(context, it) } ?: \"...\" ) hourly.weatherCode?.let { // Set icon views.setViewVisibility(hourlyId[2], View.VISIBLE) views.setImageViewUri( hourlyId[2], ResourceHelper.getWidgetNotificationIconUri( provider, it, hourly.isDaylight ?: dayTime, minimalIcon, color.minimalIconColor ) ) } ?: views.setViewVisibility(hourlyId[2], View.INVISIBLE) // Make sure the parent item container is visible (assuming parent ID is widget_clock_day_hour_week_hour_item_x) val parentId = context.resources.getIdentifier(\"widget_clock_day_hour_week_hour_item_${i + 1}\", \"id\", context.packageName) if (parentId != 0) views.setInt(parentId, \"setVisibility\", View.VISIBLE) } else { // Hide unused items (preferably the parent container) val parentId = context.resources.getIdentifier(\"widget_clock_day_hour_week_hour_item_${i + 1}\", \"id\", context.packageName) if (parentId != 0) views.setInt(parentId, \"setVisibility\", View.GONE) // Fallback: If parent ID isn't found, hide individual elements // else { views.setInt(hourlyId[0], \"setVisibility\", View.GONE); ... } } } // If no hourly data, hide the entire hourly section views.setViewVisibility( R.id.widget_clock_day_hour_week_hourly_container, if (hourlyItemCount \u003e 0) View.VISIBLE else View.GONE ) Daily Forecast: This logic is very similar to the original ClockDayWeekWidgetIMP, just make sure to use the new IDs from our modified layout. It also needs the same treatment for handling insufficient data (hiding extra views) and hiding the entire daily container if no data exists. Apply Styles: Text Color: If a specific text color is configured (textColor != Color.TRANSPARENT), loop through all relevant TextViews (including the newly added hourly ones!) and use setTextColor. Text Size: If a non-100% size is set (textSize != 100), calculate the scale, get base dimensions ( R.dimen.xxx), multiply by scale, and then loop through all relevant TextViews, setting the size with setTextViewTextSize(TypedValue.COMPLEX_UNIT_PX, size). Remember the new hourly TextViews! You might need different base dimensions for different parts (clock vs. content vs. hourly time vs. daily day name). Clock Font: Use a when statement on clockFont to set the visibility of the appropriate TextClock container. Card Background: If color.showCard is true, set the background drawable (setImageViewResource) and its alpha (setInt(id, \"setImageAlpha\", alpha)). Set Click Actions: Call the setOnClickPendingIntent method, passing the context, views, and location.\nsetOnClickPendingIntent:\nThis method wires up the clickable elements (weather icon, date, clock, daily icons) to perform actions. It creates PendingIntents and binds them using views.setOnClickPendingIntent(viewId, pendingIntent).\nThe crucial part is giving each PendingIntent a unique Request Code. We define these constants centrally in Widgets.kt. Breezy Weather provides helpers for common intents: getWeatherPendingIntent: Opens the main app screen. getDailyForecastPendingIntent: Opens the app scrolled to the specific forecast day. getAlarmPendingIntent: Tries to open the system alarm/clock app. getCalendarPendingIntent: Tries to open the system calendar app. We need to define a new block of non-conflicting request codes in Widgets.kt for ClockDayHourWeekWidget (e.g., starting with 14x). // Inside ClockDayHourWeekWidgetIMP.kt private fun setOnClickPendingIntent(context: Context, views: RemoteViews, location: Location) { // Click main weather area -\u003e Open App views.setOnClickPendingIntent( R.id.widget_clock_day_hour_week_weather, // ID of the main content container getWeatherPendingIntent(context, location, Widgets.CLOCK_DAY_HOUR_WEEK_PENDING_INTENT_CODE_WEATHER) // Use new code ) // Click daily forecast icon -\u003e Open App to that day val todayIndex = location.weather?.todayIndex ?: 0 views.setOnClickPendingIntent( R.id.widget_clock_day_hour_week_day_icon_1, // Day 1 icon ID getDailyForecastPendingIntent(context, location, todayIndex, Widgets.CLOCK_DAY_HOUR_WEEK_PENDING_INTENT_CODE_DAILY_FORECAST_1) // New code ) // ... Set similar PendingIntents for day_icon_2 to day_icon_5 ... // Click clock -\u003e Open Alarm/Clock App views.setOnClickPendingIntent( R.id.widget_clock_day_hour_week_clock_light, // Light font clock ID getAlarmPendingIntent(context, Widgets.CLOCK_DAY_HOUR_WEEK_PENDING_INTENT_CODE_CLOCK_LIGHT) // New code ) // ... Set similar PendingIntents for normal and black font clocks ... // Click date -\u003e Open Calendar App views.setOnClickPendingIntent( R.id.widget_clock_day_hour_week_title, // Date TextClock ID getCalendarPendingIntent(context, Widgets.CLOCK_DAY_HOUR_WEEK_PENDING_INTENT_CODE_CALENDAR) // New code ) // Clicks for hourly forecast items could be added here if needed, // but the current design doesn't seem to require them. /* views.setOnClickPendingIntent( R.id.widget_clock_day_hour_week_hour_icon_1, // getHourlyForecastPendingIntent(...) // Would need a helper and codes ) */ } 3. Configuration Activity (ClockDayHourWeekWidgetConfigActivity.kt) This activity lets users tweak the widget when they first add it. Copying ClockDayWeekWidgetConfigActivity.kt is the path of least resistance.\nModifications Needed:\nRename the class to ClockDayHourWeekWidgetConfigActivity. initLocations(): Ensure withHourly = true when fetching weather data, just like in the Provider. Even if the preview doesn’t show hourly details, the underlying data might be needed for other logic (like determining isDaylight accurately for icons if the current condition isn’t available). // Inside ClockDayHourWeekWidgetConfigActivity.kt override suspend fun initLocations() { val location = locationRepository.getFirstLocation(withParameters = false) locationNow = location?.copy( weather = weatherRepository.getWeatherByLocationId( location.formattedId, withDaily = true, withHourly = true, // Ensure hourly data is fetched withMinutely = false, withAlerts = false ) ) } initData(): Set default configuration values, like the initial clock font (clockFontValueNow). The base class AbstractWidgetConfigActivity handles defaults for card style, color, alpha, etc. initView(): Control which configuration options are visible on the screen. For this widget, options for card style, alpha, text color, text size, clock font, and hiding the alternate calendar should all be visible. updateWidgetView(): When the user changes a setting in the config UI, this method calls ClockDayHourWeekWidgetIMP.updateWidgetView to immediately update the widget instance on the home screen (live preview effect). remoteViews (getter): This property provides the RemoteViews for the preview area within the config screen. It must call ClockDayHourWeekWidgetIMP.getRemoteViews, passing the current selections from the config UI ( cardStyleValueNow, cardAlpha, textColorValueNow, etc.). configStoreName (getter): Returns the unique SharedPreferences key used to store this widget’s settings. Must be unique! We’ll define this key in keys.xml. // Inside ClockDayHourWeekWidgetConfigActivity.kt override val configStoreName: String get() { // Return the new key we define in keys.xml return getString(R.string.sp_widget_clock_day_hour_week_setting) } 4. XML Layout Files We need two layout files: layout/widget_clock_day_hour_week.xml (no background) and layout/widget_clock_day_hour_week_card.xml (with background).\nCopy widget_clock_day_week.xml and widget_clock_day_week_card.xml and then modify them.\nKey Modifications:\nRename Root Layout and ALL View IDs: To prevent clashes, systematically rename all IDs. A good practice is to replace widget_clock_day_week_ with widget_clock_day_hour_week_. Add Hourly Forecast Section: Between the “Date/Place/Current Temp” section and the “Daily Forecast” section, insert a new LinearLayout. Give it the ID android:id=\"@+id/widget_clock_day_hour_week_hourly_container\". Set its orientation=\"horizontal\". Inside it, place 5 child LinearLayouts (or RelativeLayouts), each representing one hour’s forecast. Set each hourly item’s LinearLayout to orientation=\"vertical\", layout_width=\"0dp\", layout_height=\"wrap_content\", layout_weight=\"1\", gravity=\"center_horizontal\". Give them unique IDs like widget_clock_day_hour_week_hour_item_1 through item_5. Inside each hourly item LinearLayout, place the three necessary views: A TextView for the time (widget_clock_day_hour_week_hour_time_x). An ImageView for the weather icon (widget_clock_day_hour_week_hour_icon_x). A TextView for the temperature (widget_clock_day_hour_week_hour_temp_x). Use dimensions from dimens.xml, like @dimen/widget_time_text_size for the time, @dimen/widget_content_text_size for the temp, and @dimen/widget_little_weather_icon_size for the icon. Modify Daily Forecast IDs: Rename the original daily forecast IDs (like widget_clock_day_week_week_x, _temp_x, _icon_x) to widget_clock_day_hour_week_day_week_x, _day_temp_x, _day_icon_x. Also, give the parent LinearLayout container for the daily forecast an ID, like widget_clock_day_hour_week_daily_container. widget_clock_day_hour_week_card.xml: This file is essentially a copy of widget_clock_day_hour_week.xml, but with an ImageView added as the first child inside the root RelativeLayout. This ImageView will display the card background; give it the ID widget_clock_day_hour_week_card. ","wordCount":"3511","inLanguage":"en","datePublished":"2025-03-30T16:40:50+08:00","dateModified":"2025-03-30T16:40:50+08:00","author":{"@type":"Person","name":"Tategoto Azarasi"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://tategotoazarasi.github.io/en/posts/clock-day-hour-week-widget/"},"publisher":{"@type":"Organization","name":"Tategoto Azarasi","logo":{"@type":"ImageObject","url":"https://tategotoazarasi.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://tategotoazarasi.github.io/en/ accesskey=h title="Tategoto Azarasi (Alt + H)">Tategoto Azarasi</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://tategotoazarasi.github.io/zh/ title=中文 aria-label=中文>Zh</a></li></ul></div></div><ul id=menu><li><a href=https://tategotoazarasi.github.io/en/ title=Home><span>Home</span></a></li><li><a href=https://tategotoazarasi.github.io/en/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://tategotoazarasi.github.io/en/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://tategotoazarasi.github.io/en/>Home</a>&nbsp;»&nbsp;<a href=https://tategotoazarasi.github.io/en/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Dev Log: Adding a All-in-One Widget to Breezy Weather - The ClockDayHourWeekWidget Journey</h1><div class=post-meta><span title='2025-03-30 16:40:50 +0800 +0800'>March 30, 2025</span>&nbsp;·&nbsp;17 min&nbsp;·&nbsp;3511 words&nbsp;·&nbsp;Tategoto Azarasi&nbsp;|&nbsp;Translations:<ul class=i18n_list><li><a href=https://tategotoazarasi.github.io/zh/posts/clock-day-hour-week-widget/>Zh</a></li></ul></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ol><li><a href=#1-the-big-picture-standing-on-the-shoulders-of-giants>1. The Big Picture: Standing on the Shoulders of Giants</a></li><li><a href=#2-getting-our-hands-dirty-creating-the-components>2. Getting Our Hands Dirty: Creating the Components</a><ol><li><a href=#1-widget-provider-clockdayhourweekwidgetproviderkt>1. Widget Provider (<code>ClockDayHourWeekWidgetProvider.kt</code>)</a></li><li><a href=#2-widget-implementation-clockdayhourweekwidgetimpkt>2. Widget Implementation (<code>ClockDayHourWeekWidgetIMP.kt</code>)</a></li><li><a href=#3-configuration-activity-clockdayhourweekwidgetconfigactivitykt>3. Configuration Activity (<code>ClockDayHourWeekWidgetConfigActivity.kt</code>)</a></li><li><a href=#4-xml-layout-files>4. XML Layout Files</a></li><li><a href=#5-widget-definition-xml>5. Widget Definition XML</a></li></ol></li><li><a href=#3-stitching-it-all-together-resources--registration>3. Stitching It All Together: Resources & Registration</a></li><li><a href=#4-wrapping-up--final-thoughts>4. Wrapping Up & Final Thoughts</a></li></ol></nav></div></details></div><div class=post-content><p>I was tinkering with Breezy Weather, the open-source weather app, the other day. It&rsquo;s got a decent collection of
widgets, but I felt like something was missing – one of those &ldquo;kitchen sink&rdquo; widgets that just throws everything you
need onto your home screen. You know, the current time, what the weather&rsquo;s doing <em>right now</em>, what it&rsquo;s gonna do in the
<em>next few hours</em>, AND the outlook for the <em>next few days</em>. I got tired of either opening the app or juggling multiple
widgets to get the full picture. Naturally, the itch to code kicked in, and I decided to build it myself. Let&rsquo;s call it
the <code>ClockDayHourWeekWidget</code>.</p><p>This blog post is basically my development log. I&rsquo;m jotting down the thought process, the steps I took, and a few bumps
I hit along the way. It&rsquo;s mainly for my future self, but hopefully, it might be useful for anyone else interested in
Android widget development or maybe even contributing to Breezy Weather. The style&rsquo;s going to be pretty casual – think
of it as dev notes – but I&rsquo;ll make sure to include the key technical bits and enough code snippets so you can understand
what&rsquo;s going on and potentially replicate it.</p><p><strong>The Goal:</strong></p><p>Create a new Android App Widget that displays:</p><ol><li><strong>Current Time:</strong> Just like your standard clock.</li><li><strong>Current Weather:</strong> Icon, location name, current temperature.</li><li><strong>Hourly Forecast:</strong> A glimpse of the weather (icon, time, temp) for the next few hours (e.g., the next 5).</li><li><strong>Daily Forecast:</strong> The usual suspects (icon, day of the week, high/low temp) for the next few days (e.g., the next
5).</li><li><strong>Configurability:</strong> Following the Breezy Weather pattern, allow users to customize background style, transparency,
text color, text size, clock font, etc., via a configuration screen.</li></ol><p>Alright, goal set. Let&rsquo;s dive in!</p><h2 id=1-the-big-picture-standing-on-the-shoulders-of-giants>1. The Big Picture: Standing on the Shoulders of Giants<a hidden class=anchor aria-hidden=true href=#1-the-big-picture-standing-on-the-shoulders-of-giants>#</a></h2><p>Thankfully, Breezy Weather has a pretty well-defined structure, especially for adding new widgets. Looking at existing
files like <code>WidgetClockDayWeekProvider.kt</code> and <code>HourlyTrendWidgetIMP.kt</code>, the pattern becomes clear. To add a new
widget, you generally need these pieces:</p><ol><li><strong><code>AppWidgetProvider</code> (e.g., <code>XxxWidgetProvider.kt</code>):</strong> This is the widget&rsquo;s entry point. It extends
<code>AppWidgetProvider</code> and receives system broadcasts, most importantly <code>onUpdate</code>. Its main job is to kick off the real
work of loading data and updating the view.</li><li><strong>Widget Implementation (e.g., <code>XxxWidgetIMP.kt</code>):</strong> Often an <code>object</code> (Kotlin singleton) inheriting from
<code>AbstractRemoteViewsPresenter</code>. This is where the magic happens: fetching data, loading user configuration, building
the <code>RemoteViews</code> object (which defines the widget&rsquo;s UI), and handling click intents.</li><li><strong>Configuration Activity (e.g., <code>XxxWidgetConfigActivity.kt</code>):</strong> An <code>Activity</code> extending
<code>AbstractWidgetConfigActivity</code>. It pops up when the user adds the widget, allowing them to customize its appearance (
background, colors, etc.). It also needs to show a live preview of the settings.</li><li><strong>XML Layout Files (<code>widget_xxx.xml</code>, <code>widget_xxx_card.xml</code>):</strong> These define the static structure of the widget&rsquo;s UI.
Typically, there&rsquo;s a version without a background card and one with it.</li><li><strong>Widget Definition XML (<code>xml/widget_xxx.xml</code>, <code>xml/v28/widget_xxx.xml</code>):</strong> This metadata file tells the Android
system about the widget – its minimum size, preview image, the configuration activity to launch, update frequency (
usually 0 here, as updates are triggered programmatically), etc. The <code>v28</code> version usually adds
<code>widgetFeatures="reconfigurable"</code>.</li><li><strong>Resource Updates:</strong> You&rsquo;ll need to touch several resource files:<ul><li><code>dimens.xml</code>: Possibly define new dimensions if needed.</li><li><code>keys.xml</code>: Add a unique SharedPreferences key for storing the widget&rsquo;s settings.</li><li><code>strings.xml</code>: Add the user-visible name for the widget.</li><li><code>AndroidManifest.xml</code>: Register the new Provider and Config Activity.</li><li><code>Widgets.kt</code>: Add unique request codes for <code>PendingIntent</code>s.</li></ul></li></ol><p>Basically, follow this recipe, create or modify each part, and voilà – a new widget is born. For our
<code>ClockDayHourWeekWidget</code>, the existing <code>ClockDayWeekWidget</code> is a great starting point. It already handles the clock,
date, current weather, and daily forecast. Our main task is to surgically insert the &ldquo;hourly forecast&rdquo; section into it.</p><h2 id=2-getting-our-hands-dirty-creating-the-components>2. Getting Our Hands Dirty: Creating the Components<a hidden class=anchor aria-hidden=true href=#2-getting-our-hands-dirty-creating-the-components>#</a></h2><p>Let&rsquo;s build this thing piece by piece.</p><h3 id=1-widget-provider-clockdayhourweekwidgetproviderkt>1. Widget Provider (<code>ClockDayHourWeekWidgetProvider.kt</code>)<a hidden class=anchor aria-hidden=true href=#1-widget-provider-clockdayhourweekwidgetproviderkt>#</a></h3><p>This one&rsquo;s relatively straightforward. We can copy <code>WidgetClockDayWeekProvider.kt</code> and make a few tweaks:</p><ul><li>Rename the class to <code>ClockDayHourWeekWidgetProvider</code>.</li><li>Inside the <code>onUpdate</code> method, make sure it calls the <code>updateWidgetView</code> method of our <em>new</em> implementation class,
<code>ClockDayHourWeekWidgetIMP</code>.</li><li><strong>Key Point:</strong> When calling <code>weatherRepository.getWeatherByLocationId</code>, we absolutely <em>must</em> set both
<code>withDaily = true</code> and <code>withHourly = true</code>. Our widget needs both sets of forecast data.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// src/main/java/org/breezyweather/background/receiver/widget/ClockDayHourWeekWidgetProvider.kt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>package</span> org.breezyweather.background.receiver.widget
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// ... other imports ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> org.breezyweather.remoteviews.presenters.ClockDayHourWeekWidgetIMP <span style=color:#75715e>// Reference the new IMP
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> javax.inject.Inject
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>@AndroidEntryPoint</span> <span style=color:#75715e>// Hilt annotation is crucial
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ClockDayHourWeekWidgetProvider</span> : AppWidgetProvider() {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Inject</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> locationRepository: LocationRepository
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@Inject</span> <span style=color:#66d9ef>lateinit</span> <span style=color:#66d9ef>var</span> weatherRepository: WeatherRepository
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>@OptIn</span>(DelicateCoroutinesApi<span style=color:#f92672>::</span><span style=color:#66d9ef>class</span>) <span style=color:#75715e>// Note: Using GlobalScope here, a common but not ideal practice in Providers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>onUpdate</span>(
</span></span><span style=display:flex><span>        context: Context,
</span></span><span style=display:flex><span>        appWidgetManager: AppWidgetManager,
</span></span><span style=display:flex><span>        appWidgetIds: IntArray,
</span></span><span style=display:flex><span>    ) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>super</span>.onUpdate(context, appWidgetManager, appWidgetIds)
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Check if any widget of this type is still in use
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>ClockDayHourWeekWidgetIMP</span>.isInUse(context)) {
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Launch a coroutine on the IO dispatcher to fetch data
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#a6e22e>GlobalScope</span>.launch(<span style=color:#a6e22e>Dispatchers</span>.IO) {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Get the first location (without parameters)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>val</span> location = locationRepository.getFirstLocation(withParameters = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Call the IMP to update the view
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#a6e22e>ClockDayHourWeekWidgetIMP</span>.updateWidgetView(
</span></span><span style=display:flex><span>                    context,
</span></span><span style=display:flex><span>                    location<span style=color:#f92672>?.</span>copy( <span style=color:#75715e>// Use copy to create a new object and fill in the weather
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                        weather = weatherRepository.getWeatherByLocationId(
</span></span><span style=display:flex><span>                            location.formattedId,
</span></span><span style=display:flex><span>                            withDaily = <span style=color:#66d9ef>true</span>,  <span style=color:#75715e>// Needed for daily data (isDaylight, daily forecast)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                            withHourly = <span style=color:#66d9ef>true</span>, <span style=color:#75715e>// !! Must be true, we need hourly data !!
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                            withMinutely = <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>                            withAlerts = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>                        )
</span></span><span style=display:flex><span>                    )
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>A quick note on <code>GlobalScope.launch(Dispatchers.IO)</code>: In the <code>onUpdate</code> method of an <code>AppWidgetProvider</code>, which runs on
the main thread and has a short lifespan, this is a fairly common way to handle potentially long-running operations like
network requests or database access. While <code>GlobalScope</code> isn&rsquo;t generally recommended (its coroutines are tied to the
application&rsquo;s lifecycle and harder to manage), it&rsquo;s a simpler solution in this specific context. More robust approaches
might involve <code>goAsync()</code> paired with a Hilt-injected <code>CoroutineScope</code> or even <code>WorkManager</code>, but sticking to the
existing pattern keeps things simpler here.</p><h3 id=2-widget-implementation-clockdayhourweekwidgetimpkt>2. Widget Implementation (<code>ClockDayHourWeekWidgetIMP.kt</code>)<a hidden class=anchor aria-hidden=true href=#2-widget-implementation-clockdayhourweekwidgetimpkt>#</a></h3><p>This is the beast. Most of the UI construction logic lives here. Again, copying <code>ClockDayWeekWidgetIMP.kt</code> gives us a
solid foundation to build upon.</p><p><strong>Its Main Responsibilities:</strong></p><ul><li><code>updateWidgetView</code>: Called by the Provider. Gets the config, calls <code>getRemoteViews</code> to build the UI, and finally
updates the widget via <code>AppWidgetManager</code>.</li><li><code>getRemoteViews</code>: The core method. Takes <code>Context</code>, <code>Location</code> data, and various config parameters, returning a fully
constructed <code>RemoteViews</code> object.</li><li><code>isInUse</code>: Checks if any instances of this specific widget type exist.</li><li><code>setOnClickPendingIntent</code>: Sets up the actions (like opening the app or calendar) when users click on different parts
of the widget.</li></ul><p><strong>Breaking Down <code>getRemoteViews</code>:</strong></p><ol><li><p><strong>Get Config & Colors:</strong> Use <code>getWidgetConfig</code> to load saved settings and initialize <code>WidgetColor</code> to handle color
logic based on config and day/night status.</p></li><li><p><strong>Choose Layout:</strong> Based on <code>WidgetColor</code>&rsquo;s judgment (whether to show a card background), load either
<code>R.layout.widget_clock_day_hour_week</code> or <code>R.layout.widget_clock_day_hour_week_card</code>.</p></li><li><p><strong>Prepare Data:</strong> Extract <code>weather</code> data from the <code>Location</code> object, get instances of <code>SettingsManager</code>,
<code>ResourcesProviderFactory</code>, etc.</p></li><li><p><strong>Populate Sections (using <code>views.setXXX</code> methods):</strong></p><ul><li><strong>Clock:</strong> Set the <code>TextClock</code> timezone (<code>setTimeZone</code>). Control the visibility (<code>setViewVisibility</code>) of the
different font-styled <code>TextClock</code> views based on the <code>clockFont</code> config.</li><li><strong>Date:</strong> Set the <code>TextClock</code> timezone and date format (<code>setCharSequence</code> with <code>format12Hour</code>/<code>format24Hour</code>).</li><li><strong>Current Weather:</strong><ul><li>Icon: Get the icon URI using <code>ResourceHelper.getWidgetNotificationIconUri</code> and set it with <code>setImageViewUri</code>.
Handle potential nulls (<code>weather.current</code> or <code>weatherCode</code>) by hiding the view (
<code>setViewVisibility(View.INVISIBLE)</code>).</li><li>Alternate Calendar: Set the <code>TextView</code> text based on <code>CalendarHelper</code> settings and the <code>hideAlternateCalendar</code>
config.</li><li>Place & Current Temp: Concatenate the strings and set the text for the corresponding <code>TextView</code>.</li></ul></li><li><strong>Hourly Forecast (The New Bit):</strong><ul><li>This is the core addition. We need the <code>LinearLayout</code> container designated for the hourly forecast in our
layout.</li><li>Define an array of IDs to easily access the time <code>TextView</code>, temperature <code>TextView</code>, and weather <code>ImageView</code>
for each hourly item.</li><li>Get the <code>weather.nextHourlyForecast</code> list, limiting it to a maximum number (e.g., <code>MAX_HOURLY_ITEMS = 5</code>).</li><li><strong>Loop Through Data:</strong> Iterate <code>min(MAX_HOURLY_ITEMS, weather.nextHourlyForecast.size)</code> times.<ul><li>Get the <code>HourlyForecast</code> object for the current hour.</li><li>Set the time <code>TextView</code>&rsquo;s text (using <code>hourly.date.getHour(location, context)</code>).</li><li>Set the temperature <code>TextView</code>&rsquo;s text (using <code>temperatureUnit.getShortValueText</code>), handling potential
nulls.</li><li>Set the weather <code>ImageView</code>&rsquo;s icon (using <code>ResourceHelper.getWidgetNotificationIconUri</code>), again handling
potential nulls for <code>weatherCode</code> and using <code>hourly.isDaylight</code> to pick the correct day/night icon.</li><li><strong>Control Visibility:</strong> Ensure this forecast item is visible (<code>setVisibility(View.VISIBLE)</code>).</li></ul></li><li><strong>Handle Excess Views:</strong> For any placeholder views in the layout beyond the available data (e.g., layout has 5
slots, API gives 3 hours), hide them (<code>setVisibility(View.GONE)</code>). It&rsquo;s best to hide the entire parent
<code>LinearLayout</code> or <code>RelativeLayout</code> for that item.</li><li><strong>Container Visibility:</strong> If there&rsquo;s <em>no</em> hourly data at all (<code>hourlyItemCount == 0</code>), hide the entire hourly
forecast container <code>LinearLayout</code> (<code>widget_clock_day_hour_week_hourly_container</code>).</li></ul></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// Inside ClockDayHourWeekWidgetIMP.kt -&gt; getRemoteViews() (Hourly Forecast Snippet)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#75715e>// --- Hourly Forecast ---
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>val</span> hourlyIds = arrayOf(
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ... (Define 2D array of TextView and ImageView IDs) ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    arrayOf(<span style=color:#a6e22e>R</span>.id.widget_clock_day_hour_week_hour_time_1, <span style=color:#a6e22e>R</span>.id.widget_clock_day_hour_week_hour_temp_1, <span style=color:#a6e22e>R</span>.id.widget_clock_day_hour_week_hour_icon_1),
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ... other hours ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>)
</span></span><span style=display:flex><span><span style=color:#66d9ef>val</span> hourlyItemCount = min(MAX_HOURLY_ITEMS, weather.nextHourlyForecast.size)
</span></span><span style=display:flex><span>hourlyIds.forEachIndexed { i, hourlyId <span style=color:#f92672>-&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (i &lt; hourlyItemCount) {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>val</span> hourly = weather.nextHourlyForecast[i]
</span></span><span style=display:flex><span>        views.setTextViewText(hourlyId[<span style=color:#ae81ff>0</span>], hourly.date.getHour(location, context)) <span style=color:#75715e>// Set time
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        views.setTextViewText(
</span></span><span style=display:flex><span>            hourlyId[<span style=color:#ae81ff>1</span>], <span style=color:#75715e>// Set temperature
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            hourly.temperature<span style=color:#f92672>?.</span>temperature<span style=color:#f92672>?.</span>let { temperatureUnit.getShortValueText(context, <span style=color:#66d9ef>it</span>) } <span style=color:#f92672>?:</span> <span style=color:#e6db74>&#34;...&#34;</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        hourly.weatherCode<span style=color:#f92672>?.</span>let { <span style=color:#75715e>// Set icon
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            views.setViewVisibility(hourlyId[<span style=color:#ae81ff>2</span>], <span style=color:#a6e22e>View</span>.VISIBLE)
</span></span><span style=display:flex><span>            views.setImageViewUri(
</span></span><span style=display:flex><span>                hourlyId[<span style=color:#ae81ff>2</span>],
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>ResourceHelper</span>.getWidgetNotificationIconUri(
</span></span><span style=display:flex><span>                    provider, <span style=color:#66d9ef>it</span>, hourly.isDaylight <span style=color:#f92672>?:</span> dayTime, minimalIcon, color.minimalIconColor
</span></span><span style=display:flex><span>                )
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>        } <span style=color:#f92672>?:</span> views.setViewVisibility(hourlyId[<span style=color:#ae81ff>2</span>], <span style=color:#a6e22e>View</span>.INVISIBLE)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Make sure the parent item container is visible (assuming parent ID is widget_clock_day_hour_week_hour_item_x)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>val</span> parentId = context.resources.getIdentifier(<span style=color:#e6db74>&#34;widget_clock_day_hour_week_hour_item_</span><span style=color:#e6db74>${i + 1}</span><span style=color:#e6db74>&#34;</span>, <span style=color:#e6db74>&#34;id&#34;</span>, context.packageName)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (parentId <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) views.setInt(parentId, <span style=color:#e6db74>&#34;setVisibility&#34;</span>, <span style=color:#a6e22e>View</span>.VISIBLE)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Hide unused items (preferably the parent container)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>val</span> parentId = context.resources.getIdentifier(<span style=color:#e6db74>&#34;widget_clock_day_hour_week_hour_item_</span><span style=color:#e6db74>${i + 1}</span><span style=color:#e6db74>&#34;</span>, <span style=color:#e6db74>&#34;id&#34;</span>, context.packageName)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (parentId <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span>) views.setInt(parentId, <span style=color:#e6db74>&#34;setVisibility&#34;</span>, <span style=color:#a6e22e>View</span>.GONE)
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Fallback: If parent ID isn&#39;t found, hide individual elements
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// else { views.setInt(hourlyId[0], &#34;setVisibility&#34;, View.GONE); ... }
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#75715e>// If no hourly data, hide the entire hourly section
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>views.setViewVisibility(
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>R</span>.id.widget_clock_day_hour_week_hourly_container,
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (hourlyItemCount &gt; <span style=color:#ae81ff>0</span>) <span style=color:#a6e22e>View</span>.VISIBLE <span style=color:#66d9ef>else</span> <span style=color:#a6e22e>View</span>.GONE
</span></span><span style=display:flex><span>)
</span></span></code></pre></div><ul><li><strong>Daily Forecast:</strong> This logic is very similar to the original <code>ClockDayWeekWidgetIMP</code>, just make sure to use the
new IDs from our modified layout. It also needs the same treatment for handling insufficient data (hiding extra
views) and hiding the entire daily container if no data exists.</li><li><strong>Apply Styles:</strong><ul><li>Text Color: If a specific text color is configured (<code>textColor != Color.TRANSPARENT</code>), loop through <em>all</em>
relevant <code>TextView</code>s (including the newly added hourly ones!) and use <code>setTextColor</code>.</li><li>Text Size: If a non-100% size is set (<code>textSize != 100</code>), calculate the <code>scale</code>, get base dimensions (
<code>R.dimen.xxx</code>), multiply by <code>scale</code>, and then loop through <em>all</em> relevant <code>TextView</code>s, setting the size with
<code>setTextViewTextSize(TypedValue.COMPLEX_UNIT_PX, size)</code>. Remember the new hourly <code>TextView</code>s! You might need
different base dimensions for different parts (clock vs. content vs. hourly time vs. daily day name).</li><li>Clock Font: Use a <code>when</code> statement on <code>clockFont</code> to set the visibility of the appropriate <code>TextClock</code>
container.</li><li>Card Background: If <code>color.showCard</code> is true, set the background drawable (<code>setImageViewResource</code>) and its
alpha (<code>setInt(id, "setImageAlpha", alpha)</code>).</li></ul></li></ul></li><li><p><strong>Set Click Actions:</strong> Call the <code>setOnClickPendingIntent</code> method, passing the <code>context</code>, <code>views</code>, and <code>location</code>.</p></li></ol><p><strong><code>setOnClickPendingIntent</code>:</strong></p><p>This method wires up the clickable elements (weather icon, date, clock, daily icons) to perform actions. It creates
<code>PendingIntent</code>s and binds them using <code>views.setOnClickPendingIntent(viewId, pendingIntent)</code>.</p><ul><li>The crucial part is giving each <code>PendingIntent</code> a <strong>unique Request Code</strong>. We define these constants centrally in
<code>Widgets.kt</code>.</li><li>Breezy Weather provides helpers for common intents:<ul><li><code>getWeatherPendingIntent</code>: Opens the main app screen.</li><li><code>getDailyForecastPendingIntent</code>: Opens the app scrolled to the specific forecast day.</li><li><code>getAlarmPendingIntent</code>: Tries to open the system alarm/clock app.</li><li><code>getCalendarPendingIntent</code>: Tries to open the system calendar app.</li></ul></li><li>We need to define a <em>new block</em> of non-conflicting request codes in <code>Widgets.kt</code> for <code>ClockDayHourWeekWidget</code> (e.g.,
starting with <code>14x</code>).</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// Inside ClockDayHourWeekWidgetIMP.kt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>private</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>setOnClickPendingIntent</span>(context: Context, views: RemoteViews, location: Location) {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Click main weather area -&gt; Open App
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    views.setOnClickPendingIntent(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>R</span>.id.widget_clock_day_hour_week_weather, <span style=color:#75715e>// ID of the main content container
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        getWeatherPendingIntent(context, location, <span style=color:#a6e22e>Widgets</span>.CLOCK_DAY_HOUR_WEEK_PENDING_INTENT_CODE_WEATHER) <span style=color:#75715e>// Use new code
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Click daily forecast icon -&gt; Open App to that day
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>val</span> todayIndex = location.weather<span style=color:#f92672>?.</span>todayIndex <span style=color:#f92672>?:</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    views.setOnClickPendingIntent(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>R</span>.id.widget_clock_day_hour_week_day_icon_1, <span style=color:#75715e>// Day 1 icon ID
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        getDailyForecastPendingIntent(context, location, todayIndex, <span style=color:#a6e22e>Widgets</span>.CLOCK_DAY_HOUR_WEEK_PENDING_INTENT_CODE_DAILY_FORECAST_1) <span style=color:#75715e>// New code
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    )
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ... Set similar PendingIntents for day_icon_2 to day_icon_5 ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Click clock -&gt; Open Alarm/Clock App
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    views.setOnClickPendingIntent(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>R</span>.id.widget_clock_day_hour_week_clock_light, <span style=color:#75715e>// Light font clock ID
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        getAlarmPendingIntent(context, <span style=color:#a6e22e>Widgets</span>.CLOCK_DAY_HOUR_WEEK_PENDING_INTENT_CODE_CLOCK_LIGHT) <span style=color:#75715e>// New code
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    )
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ... Set similar PendingIntents for normal and black font clocks ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Click date -&gt; Open Calendar App
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    views.setOnClickPendingIntent(
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>R</span>.id.widget_clock_day_hour_week_title, <span style=color:#75715e>// Date TextClock ID
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        getCalendarPendingIntent(context, <span style=color:#a6e22e>Widgets</span>.CLOCK_DAY_HOUR_WEEK_PENDING_INTENT_CODE_CALENDAR) <span style=color:#75715e>// New code
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    )
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Clicks for hourly forecast items could be added here if needed,
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// but the current design doesn&#39;t seem to require them.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>/*
</span></span></span><span style=display:flex><span><span style=color:#75715e>    views.setOnClickPendingIntent(
</span></span></span><span style=display:flex><span><span style=color:#75715e>        R.id.widget_clock_day_hour_week_hour_icon_1,
</span></span></span><span style=display:flex><span><span style=color:#75715e>        // getHourlyForecastPendingIntent(...) // Would need a helper and codes
</span></span></span><span style=display:flex><span><span style=color:#75715e>    )
</span></span></span><span style=display:flex><span><span style=color:#75715e>    */</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=3-configuration-activity-clockdayhourweekwidgetconfigactivitykt>3. Configuration Activity (<code>ClockDayHourWeekWidgetConfigActivity.kt</code>)<a hidden class=anchor aria-hidden=true href=#3-configuration-activity-clockdayhourweekwidgetconfigactivitykt>#</a></h3><p>This activity lets users tweak the widget when they first add it. Copying <code>ClockDayWeekWidgetConfigActivity.kt</code> is the
path of least resistance.</p><p><strong>Modifications Needed:</strong></p><ul><li>Rename the class to <code>ClockDayHourWeekWidgetConfigActivity</code>.</li><li><strong><code>initLocations()</code>:</strong> Ensure <code>withHourly = true</code> when fetching weather data, just like in the Provider. Even if the
preview doesn&rsquo;t show hourly details, the underlying data might be needed for other logic (like determining
<code>isDaylight</code> accurately for icons if the current condition isn&rsquo;t available).<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// Inside ClockDayHourWeekWidgetConfigActivity.kt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>override</span> <span style=color:#66d9ef>suspend</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>initLocations</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>val</span> location = locationRepository.getFirstLocation(withParameters = <span style=color:#66d9ef>false</span>)
</span></span><span style=display:flex><span>    locationNow = location<span style=color:#f92672>?.</span>copy(
</span></span><span style=display:flex><span>        weather = weatherRepository.getWeatherByLocationId(
</span></span><span style=display:flex><span>            location.formattedId,
</span></span><span style=display:flex><span>            withDaily = <span style=color:#66d9ef>true</span>,
</span></span><span style=display:flex><span>            withHourly = <span style=color:#66d9ef>true</span>, <span style=color:#75715e>// Ensure hourly data is fetched
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            withMinutely = <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>            withAlerts = <span style=color:#66d9ef>false</span>
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>    )
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></li><li><strong><code>initData()</code>:</strong> Set default configuration values, like the initial clock font (<code>clockFontValueNow</code>). The base class
<code>AbstractWidgetConfigActivity</code> handles defaults for card style, color, alpha, etc.</li><li><strong><code>initView()</code>:</strong> Control which configuration options are visible on the screen. For this widget, options for card
style, alpha, text color, text size, clock font, and hiding the alternate calendar should all be visible.</li><li><strong><code>updateWidgetView()</code>:</strong> When the user changes a setting in the config UI, this method calls
<code>ClockDayHourWeekWidgetIMP.updateWidgetView</code> to immediately update the widget instance on the home screen (live
preview effect).</li><li><strong><code>remoteViews</code> (getter):</strong> This property provides the <code>RemoteViews</code> for the preview area within the config screen. It
must call <code>ClockDayHourWeekWidgetIMP.getRemoteViews</code>, passing the <em>current</em> selections from the config UI (
<code>cardStyleValueNow</code>, <code>cardAlpha</code>, <code>textColorValueNow</code>, etc.).</li><li><strong><code>configStoreName</code> (getter):</strong> Returns the unique SharedPreferences key used to store this widget&rsquo;s settings. <strong>Must
be unique!</strong> We&rsquo;ll define this key in <code>keys.xml</code>.<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// Inside ClockDayHourWeekWidgetConfigActivity.kt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>override</span> <span style=color:#66d9ef>val</span> configStoreName: String
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>get</span>() {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Return the new key we define in keys.xml
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>return</span> getString(<span style=color:#a6e22e>R</span>.string.sp_widget_clock_day_hour_week_setting)
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div></li></ul><h3 id=4-xml-layout-files>4. XML Layout Files<a hidden class=anchor aria-hidden=true href=#4-xml-layout-files>#</a></h3><p>We need two layout files: <code>layout/widget_clock_day_hour_week.xml</code> (no background) and
<code>layout/widget_clock_day_hour_week_card.xml</code> (with background).</p><p>Copy <code>widget_clock_day_week.xml</code> and <code>widget_clock_day_week_card.xml</code> and then modify them.</p><p><strong>Key Modifications:</strong></p><ol><li><strong>Rename Root Layout and ALL View IDs:</strong> To prevent clashes, systematically rename all IDs. A good practice is to
replace <code>widget_clock_day_week_</code> with <code>widget_clock_day_hour_week_</code>.</li><li><strong>Add Hourly Forecast Section:</strong> Between the &ldquo;Date/Place/Current Temp&rdquo; section and the &ldquo;Daily Forecast&rdquo; section,
insert a new <code>LinearLayout</code>. Give it the ID <code>android:id="@+id/widget_clock_day_hour_week_hourly_container"</code>.<ul><li>Set its <code>orientation="horizontal"</code>.</li><li>Inside it, place 5 child <code>LinearLayout</code>s (or <code>RelativeLayout</code>s), each representing one hour&rsquo;s forecast.</li><li>Set each hourly item&rsquo;s <code>LinearLayout</code> to <code>orientation="vertical"</code>, <code>layout_width="0dp"</code>,
<code>layout_height="wrap_content"</code>, <code>layout_weight="1"</code>, <code>gravity="center_horizontal"</code>. Give them unique IDs like
<code>widget_clock_day_hour_week_hour_item_1</code> through <code>item_5</code>.</li><li>Inside each hourly item <code>LinearLayout</code>, place the three necessary views:<ul><li>A <code>TextView</code> for the time (<code>widget_clock_day_hour_week_hour_time_x</code>).</li><li>An <code>ImageView</code> for the weather icon (<code>widget_clock_day_hour_week_hour_icon_x</code>).</li><li>A <code>TextView</code> for the temperature (<code>widget_clock_day_hour_week_hour_temp_x</code>).</li></ul></li><li>Use dimensions from <code>dimens.xml</code>, like <code>@dimen/widget_time_text_size</code> for the time,
<code>@dimen/widget_content_text_size</code> for the temp, and <code>@dimen/widget_little_weather_icon_size</code> for the icon.</li></ul></li><li><strong>Modify Daily Forecast IDs:</strong> Rename the original daily forecast IDs (like <code>widget_clock_day_week_week_x</code>,
<code>_temp_x</code>, <code>_icon_x</code>) to <code>widget_clock_day_hour_week_day_week_x</code>, <code>_day_temp_x</code>, <code>_day_icon_x</code>. Also, give the parent
<code>LinearLayout</code> container for the daily forecast an ID, like <code>widget_clock_day_hour_week_daily_container</code>.</li><li><strong><code>widget_clock_day_hour_week_card.xml</code>:</strong> This file is essentially a copy of <code>widget_clock_day_hour_week.xml</code>, but
with an <code>ImageView</code> added as the <em>first</em> child inside the root <code>RelativeLayout</code>. This <code>ImageView</code> will display the
card background; give it the ID <code>widget_clock_day_hour_week_card</code>.</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- layout/widget_clock_day_hour_week.xml (Snippet showing new hourly structure) --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;RelativeLayout</span> <span style=color:#960050;background-color:#1e0010>...</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;LinearLayout</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/widget_clock_day_hour_week_weather&#34;</span> <span style=color:#960050;background-color:#1e0010>...</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>&lt;!-- ... (Clock, Date, Current Weather sections - IDs modified) ... --&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>&lt;!-- Hourly Forecast --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;LinearLayout</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/widget_clock_day_hour_week_hourly_container&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;horizontal&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;match_parent&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>android:layout_marginTop=</span><span style=color:#e6db74>&#34;@dimen/little_margin&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>android:layout_marginBottom=</span><span style=color:#e6db74>&#34;@dimen/little_margin&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>android:baselineAligned=</span><span style=color:#e6db74>&#34;false&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!-- Hour 1 --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;LinearLayout</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/widget_clock_day_hour_week_hour_item_1&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;vertical&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;0dp&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;wrap_content&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>android:layout_weight=</span><span style=color:#e6db74>&#34;1&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#a6e22e>android:gravity=</span><span style=color:#e6db74>&#34;center_horizontal&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/widget_clock_day_hour_week_hour_time_1&#34;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>android:textSize=</span><span style=color:#e6db74>&#34;@dimen/widget_time_text_size&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>...</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;ImageView</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/widget_clock_day_hour_week_hour_icon_1&#34;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>android:layout_width=</span><span style=color:#e6db74>&#34;@dimen/widget_little_weather_icon_size&#34;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>android:layout_height=</span><span style=color:#e6db74>&#34;@dimen/widget_little_weather_icon_size&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>...</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>	<span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/widget_clock_day_hour_week_hour_temp_1&#34;</span>
</span></span><span style=display:flex><span>			<span style=color:#a6e22e>android:textSize=</span><span style=color:#e6db74>&#34;@dimen/widget_content_text_size&#34;</span>
</span></span><span style=display:flex><span>	<span style=color:#960050;background-color:#1e0010>...</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!-- Hour 2 to 5 (Similar structure) --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;!-- ... --&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>&lt;!-- Daily Forecast --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;LinearLayout</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/widget_clock_day_hour_week_daily_container&#34;</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>android:orientation=</span><span style=color:#e6db74>&#34;horizontal&#34;</span>
</span></span><span style=display:flex><span>		<span style=color:#960050;background-color:#1e0010>...</span> <span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>&lt;!-- Day 1 --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;LinearLayout</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/widget_clock_day_hour_week_day_item_1&#34;</span> <span style=color:#960050;background-color:#1e0010>...</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/widget_clock_day_hour_week_day_week_1&#34;</span> <span style=color:#960050;background-color:#1e0010>...</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;ImageView</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/widget_clock_day_hour_week_day_icon_1&#34;</span> <span style=color:#960050;background-color:#1e0010>...</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;TextView</span>
</span></span><span style=display:flex><span><span style=color:#a6e22e>android:id=</span><span style=color:#e6db74>&#34;@+id/widget_clock_day_hour_week_day_temp_1&#34;</span> <span style=color:#960050;background-color:#1e0010>...</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>&lt;!-- Day 2 to 5 (Similar structure, IDs modified) --&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#75715e>&lt;!-- ... --&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>&lt;/LinearLayout&gt;</span>
</span></span><span style=display:flex><span>		<span style=color:#f92672>&lt;/RelativeLayout&gt;</span>
</span></span></code></pre></div><h3 id=5-widget-definition-xml>5. Widget Definition XML<a hidden class=anchor aria-hidden=true href=#5-widget-definition-xml>#</a></h3><p>Create <code>widget_clock_day_hour_week.xml</code> in <code>res/xml/</code> and a corresponding version in <code>res/xml-v28/</code> (create the
directory if it doesn&rsquo;t exist).</p><p>Copy <code>xml/widget_clock_day_week.xml</code> and <code>xml-v28/widget_clock_day_week.xml</code>.</p><p><strong>Changes to Make:</strong></p><ul><li><strong><code>android:minWidth</code> / <code>android:minHeight</code>:</strong> Since we added the hourly forecast row, the widget needs more vertical
space. Increase <code>minHeight</code>, for example, from <code>@dimen/widget_grid_2</code> (110dp) to <code>@dimen/widget_grid_3</code> (180dp). Keep
<code>minWidth</code> at <code>@dimen/widget_grid_4</code> (250dp).</li><li><strong><code>android:minResizeHeight</code>:</strong> The minimum resize height also needs to increase accordingly, perhaps to
<code>@dimen/widget_grid_2</code>.</li><li><strong><code>android:initialLayout</code>:</strong> Point this to our new layout: <code>@layout/widget_clock_day_hour_week</code>.</li><li><strong><code>android:previewImage</code>:</strong> Point this to a new preview drawable: <code>@drawable/widget_clock_day_hour_week</code>. <strong>Remember,
you need to create this image yourself and place it in the <code>drawable</code> folders.</strong></li><li><strong><code>android:configure</code>:</strong> Point this to our new configuration activity:
<code>org.breezyweather.remoteviews.config.ClockDayHourWeekWidgetConfigActivity</code>.</li><li><strong><code>v28</code> Version:</strong> Make the same changes, and ensure <code>android:widgetFeatures="reconfigurable"</code> is present.</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- res/xml/widget_clock_day_hour_week.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;appwidget-provider</span> <span style=color:#a6e22e>xmlns:android=</span><span style=color:#e6db74>&#34;http://schemas.android.com/apk/res/android&#34;</span>
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>android:minWidth=</span><span style=color:#e6db74>&#34;@dimen/widget_grid_4&#34;</span>
</span></span><span style=display:flex><span>                    <span style=color:#a6e22e>android:minHeight=</span><span style=color:#e6db74>&#34;@dimen/widget_grid_3&#34;</span> <span style=color:#960050;background-color:#1e0010>&lt;!--</span> <span style=color:#960050;background-color:#1e0010>Increased</span> <span style=color:#960050;background-color:#1e0010>height</span> <span style=color:#960050;background-color:#1e0010>--</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>		android:minResizeWidth=&#34;@dimen/widget_grid_3&#34;
</span></span><span style=display:flex><span>		android:minResizeHeight=&#34;@dimen/widget_grid_2&#34; <span style=color:#75715e>&lt;!-- Increased resize height --&gt;</span>
</span></span><span style=display:flex><span>		android:updatePeriodMillis=&#34;0&#34;
</span></span><span style=display:flex><span>		android:initialLayout=&#34;@layout/widget_clock_day_hour_week&#34; <span style=color:#75715e>&lt;!-- Point to new layout --&gt;</span>
</span></span><span style=display:flex><span>		android:previewImage=&#34;@drawable/widget_clock_day_hour_week&#34; <span style=color:#75715e>&lt;!-- Point to new preview --&gt;</span>
</span></span><span style=display:flex><span>		android:resizeMode=&#34;horizontal|vertical&#34;
</span></span><span style=display:flex><span>		android:configure=&#34;org.breezyweather.remoteviews.config.ClockDayHourWeekWidgetConfigActivity&#34; <span style=color:#75715e>&lt;!-- Point to new config activity --&gt;</span>
</span></span><span style=display:flex><span>		android:widgetCategory=&#34;home_screen|keyguard&#34; /&gt;
</span></span></code></pre></div><h2 id=3-stitching-it-all-together-resources--registration>3. Stitching It All Together: Resources & Registration<a hidden class=anchor aria-hidden=true href=#3-stitching-it-all-together-resources--registration>#</a></h2><p>The final step is to make sure all the necessary resource definitions and registrations are in place.</p><ol><li><p><strong><code>dimens.xml</code>:</strong> Double-check the dimensions used in the layout. Existing ones like <code>@dimen/widget_time_text_size</code> (
10sp), <code>@dimen/widget_content_text_size</code> (14sp), <code>@dimen/widget_little_weather_icon_size</code> (36dp) seem appropriate. If
you feel the hourly or daily sections need specific adjustments, define new dimensions here and reference them. For
now, reusing existing ones should be fine.</p></li><li><p><strong><code>keys.xml</code>:</strong> Add the new <code>string</code> for the configuration storage key.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- res/values/keys.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;resources</span> <span style=color:#960050;background-color:#1e0010>...</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;string</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;sp_widget_clock_day_hour_week_setting&#34;</span> <span style=color:#a6e22e>translatable=</span><span style=color:#e6db74>&#34;false&#34;</span><span style=color:#f92672>&gt;</span>widget_clock_day_hour_week_setting<span style=color:#f92672>&lt;/string&gt;</span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/resources&gt;</span>
</span></span></code></pre></div></li><li><p><strong><code>strings.xml</code>:</strong> Add the user-visible name for the widget.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- res/values/strings.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;resources</span> <span style=color:#960050;background-color:#1e0010>...</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;string</span> <span style=color:#a6e22e>name=</span><span style=color:#e6db74>&#34;widget_clock_day_hour_week&#34;</span><span style=color:#f92672>&gt;</span>Clock + Day + Hour + Week<span style=color:#f92672>&lt;/string&gt;</span> <span style=color:#75715e>&lt;!-- Or your preferred name --&gt;</span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/resources&gt;</span>
</span></span></code></pre></div><p><em>(Don&rsquo;t forget translations in other <code>values-*/strings.xml</code> files if necessary!)</em></p></li><li><p><strong><code>AndroidManifest.xml</code>:</strong> Inside the <code>&lt;application></code> tag, register the new Provider (<code>&lt;receiver></code>) and Config
Activity (<code>&lt;activity></code>). It&rsquo;s good practice to group them with the other widget declarations.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#75715e>&lt;!-- AndroidManifest.xml --&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;application</span> <span style=color:#960050;background-color:#1e0010>...</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!-- ClockDayHourWeek Widget Configuration Activity --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;activity</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;.remoteviews.config.ClockDayHourWeekWidgetConfigActivity&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:theme=</span><span style=color:#e6db74>&#34;@style/BreezyWeatherTheme&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:exported=</span><span style=color:#e6db74>&#34;true&#34;</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;intent-filter&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;action</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;android.appwidget.action.APPWIDGET_CONFIGURE&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/intent-filter&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/activity&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>&lt;!-- ClockDayHourWeek Widget Provider --&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;receiver</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;.background.receiver.widget.ClockDayHourWeekWidgetProvider&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>android:label=</span><span style=color:#e6db74>&#34;@string/widget_clock_day_hour_week&#34;</span> <span style=color:#960050;background-color:#1e0010>&lt;!--</span> <span style=color:#960050;background-color:#1e0010>Reference</span> <span style=color:#960050;background-color:#1e0010>the</span> <span style=color:#960050;background-color:#1e0010>name</span> <span style=color:#960050;background-color:#1e0010>from</span> <span style=color:#960050;background-color:#1e0010>strings.xml</span> <span style=color:#960050;background-color:#1e0010>--</span><span style=color:#f92672>&gt;</span>
</span></span><span style=display:flex><span>        android:exported=&#34;true&#34;&gt;
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;meta-data</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;android.appwidget.provider&#34;</span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>android:resource=</span><span style=color:#e6db74>&#34;@xml/widget_clock_day_hour_week&#34;</span> <span style=color:#f92672>/&gt;</span> <span style=color:#75715e>&lt;!-- Reference the definition xml --&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;intent-filter&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;action</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;android.appwidget.action.APPWIDGET_UPDATE&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>&lt;action</span> <span style=color:#a6e22e>android:name=</span><span style=color:#e6db74>&#34;android.appwidget.action.ACTION_APPWIDGET_DISABLED&#34;</span> <span style=color:#f92672>/&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>&lt;/intent-filter&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&lt;/receiver&gt;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    ...
</span></span><span style=display:flex><span><span style=color:#f92672>&lt;/application&gt;</span>
</span></span></code></pre></div></li><li><p><strong><code>Widgets.kt</code>:</strong> Add the new block of PendingIntent Request Code constants. Pick an unused range (like <code>14x</code>).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=display:flex><span><span style=color:#75715e>// src/main/java/org/breezyweather/remoteviews/Widgets.kt
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>object</span> <span style=color:#a6e22e>Widgets</span> {
</span></span><span style=display:flex><span>    <span style=color:#f92672>..</span>. <span style=color:#75715e>// other constants
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// clock + day + hour + week. (Using 14x block)
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> CLOCK_DAY_HOUR_WEEK_PENDING_INTENT_CODE_WEATHER = <span style=color:#ae81ff>141</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> CLOCK_DAY_HOUR_WEEK_PENDING_INTENT_CODE_DAILY_FORECAST_1 = <span style=color:#ae81ff>1421</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> CLOCK_DAY_HOUR_WEEK_PENDING_INTENT_CODE_DAILY_FORECAST_2 = <span style=color:#ae81ff>1422</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> CLOCK_DAY_HOUR_WEEK_PENDING_INTENT_CODE_DAILY_FORECAST_3 = <span style=color:#ae81ff>1423</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> CLOCK_DAY_HOUR_WEEK_PENDING_INTENT_CODE_DAILY_FORECAST_4 = <span style=color:#ae81ff>1424</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> CLOCK_DAY_HOUR_WEEK_PENDING_INTENT_CODE_DAILY_FORECAST_5 = <span style=color:#ae81ff>1425</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> CLOCK_DAY_HOUR_WEEK_PENDING_INTENT_CODE_CALENDAR = <span style=color:#ae81ff>143</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> CLOCK_DAY_HOUR_WEEK_PENDING_INTENT_CODE_CLOCK_LIGHT = <span style=color:#ae81ff>144</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> CLOCK_DAY_HOUR_WEEK_PENDING_INTENT_CODE_CLOCK_NORMAL = <span style=color:#ae81ff>145</span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>val</span> CLOCK_DAY_HOUR_WEEK_PENDING_INTENT_CODE_CLOCK_BLACK = <span style=color:#ae81ff>146</span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Add codes here if hourly forecast items become clickable
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// const val CLOCK_DAY_HOUR_WEEK_PENDING_INTENT_CODE_HOURLY_FORECAST_1 = 1471
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>..</span>. <span style=color:#75715e>// rest of the constants
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div></li></ol><h2 id=4-wrapping-up--final-thoughts>4. Wrapping Up & Final Thoughts<a hidden class=anchor aria-hidden=true href=#4-wrapping-up--final-thoughts>#</a></h2><p>And&mldr; that should be it! After adding all these files and making the necessary resource changes, rebuild the project.
The new &ldquo;Clock + Day + Hour + Week&rdquo; widget should now appear in your system&rsquo;s widget picker. When you add it to your
home screen, the configuration activity will launch, and once configured, you should see your brand new, all-in-one
weather widget!</p><p><img loading=lazy src=/images/68747470733a2f2f692e696d6775722e636f6d2f706379757556642e706e67.png></p><p><strong>Quick Recap of the Process:</strong></p><ol><li><strong>Define the Goal:</strong> Create a comprehensive weather widget.</li><li><strong>Analyze Existing Patterns:</strong> Identify the Provider -> IMP -> Config -> Layout -> Definition XML workflow.</li><li><strong>Copy & Modify:</strong> Leverage existing code (<code>ClockDayWeek</code> components) as a base, then modify extensively, especially
the IMP and Layout files.</li><li><strong>Core Addition:</strong> Design and implement the hourly forecast section in the layout and add the corresponding
data-binding and visibility logic in the IMP&rsquo;s <code>getRemoteViews</code>.</li><li><strong>Attention to Detail:</strong> Systematically update all relevant IDs, configuration keys, widget names, and request codes
for uniqueness. Adjust widget dimensions (<code>minHeight</code>, <code>minResizeHeight</code>).</li><li><strong>Resource Integration:</strong> Add the necessary declarations and definitions in <code>AndroidManifest.xml</code>, <code>keys.xml</code>,
<code>strings.xml</code>, and <code>Widgets.kt</code>.</li></ol><p><strong>Potential Gotchas:</strong></p><ul><li><strong><code>RemoteViews</code> Limitations:</strong> Remember <code>RemoteViews</code> only supports a limited set of Views and methods. Complex
interactions or custom drawing are tricky. We stuck to basics like <code>TextView</code>, <code>ImageView</code>, <code>LinearLayout</code>,
<code>RelativeLayout</code>, and <code>TextClock</code>, which works fine.</li><li><strong>ID Conflicts:</strong> Forgetting to rename IDs after copying is an easy mistake that can lead to update errors or crashes.
Double-check them!</li><li><strong>Data Fetching:</strong> Ensure the Provider requests <code>withHourly = true</code>, otherwise, the hourly section will be empty.</li><li><strong>Layout Adaptability:</strong> Widget appearance might need fine-tuning with <code>dimens.xml</code> values to look good across
different screen sizes and densities.</li></ul><p>Overall, adding the <code>ClockDayHourWeekWidget</code> was a relatively smooth process, largely thanks to Breezy Weather&rsquo;s clean
structure and consistent widget implementation pattern. It involved a fair amount of code, but much of it was following
the established template. The key was understanding how <code>RemoteViews</code> works and carefully handling the data binding and
view states in the <code>IMP</code> class, especially for the newly added hourly section and the visibility logic for dynamic
content.</p><p>Hope this rambling dev log is helpful to someone out there! Until the next coding adventure&mldr; Cheers!</p><p><a href=https://github.com/tategotoazarasi/breezy-weather/commit/f8d8d7c258f66ead91574741322a936628bb4e7e>Source Code</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://tategotoazarasi.github.io/en/tags/breezy-weather/>Breezy-Weather</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/android-widget/>Android-Widget</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/clock-day-hour-week/>Clock-Day-Hour-Week</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/appwidgetprovider/>Appwidgetprovider</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/remoteviews/>Remoteviews</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/widget-development/>Widget-Development</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/open-source/>Open-Source</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/weather-app/>Weather-App</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/kotlin/>Kotlin</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/android-development/>Android-Development</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/breezy-weather-widget/>Breezy-Weather-Widget</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/android-app-widget/>Android-App-Widget</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/clock-widget/>Clock-Widget</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/hourly-forecast/>Hourly-Forecast</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/daily-forecast/>Daily-Forecast</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/widget-config/>Widget-Config</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/remoteviews-presenter/>Remoteviews-Presenter</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/android-layout/>Android-Layout</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/sharedpreferences/>Sharedpreferences</a></li><li><a href=https://tategotoazarasi.github.io/en/tags/pendingintent/>Pendingintent</a></li></ul><nav class=paginav><a class=next href=https://tategotoazarasi.github.io/en/posts/building-new-worlds-a-deep-dive-into-procedural-generation-for-video-games/><span class=title>Next »</span><br><span>Building New Worlds: A Deep Dive into Procedural Generation for Video Games</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://tategotoazarasi.github.io/en/>Tategoto Azarasi</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>